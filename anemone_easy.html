<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ë¯¸ì˜ Easy - ë‘ê·¼ë‘ê·¼ ê°œì²´êµ° í‚¤ìš°ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(45deg, #2563eb 0%, #06b6d4 50%, #3b82f6 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: repeating-linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.03) 0px,
                rgba(255, 255, 255, 0.03) 2px,
                transparent 2px,
                transparent 12px
            );
            pointer-events: none;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .game-container {
            width: 100vw;
            height: 56.25vw;
            max-width: 1280px;
            max-height: 720px;
            position: relative;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 2em;
            box-shadow: 
                0 0 0 3px rgba(255, 255, 255, 0.2),
                0 1.5em 4em rgba(0, 0, 0, 0.2),
                inset 0 0.06em 0 rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(0.6em);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            font-size: calc(1vw + 0.5vh);
        }

        @media (min-width: 1280px) {
            .game-container {
                font-size: 16px;
            }
        }

        @media screen and (min-aspect-ratio: 16/9) {
            .game-container {
                width: 177.78vh;
                height: 100vh;
            }
        }

        .status-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 1em 2em;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(0.3em);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 2.5em;
            height: 2.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.3s ease;
            box-shadow: 0 0.25em 0.75em rgba(0, 0, 0, 0.1);
        }

        .back-btn:hover {
            background: white;
            transform: translateY(-0.06em);
            box-shadow: 0 0.37em 1em rgba(0, 0, 0, 0.15);
        }

        .status-info {
            display: flex;
            gap: 1em;
            align-items: center;
        }

        .status-display {
            background: rgba(255, 255, 255, 0.9);
            padding: 0.5em 1em;
            border-radius: 1em;
            font-weight: 700;
            color: #2D3748;
            font-size: 0.9em;
            box-shadow: 0 0.25em 0.75em rgba(0, 0, 0, 0.1);
        }

        .graph-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            border: none;
            border-radius: 0.8em;
            padding: 0.5em 1em;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8em;
            box-shadow: 0 0.25em 0.75em rgba(72, 187, 120, 0.3);
        }

        .graph-btn:hover:not(:disabled) {
            transform: translateY(-0.06em);
            box-shadow: 0 0.37em 1em rgba(72, 187, 120, 0.4);
        }

        .graph-btn:disabled {
            background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .character-area {
            position: absolute;
            top: 4em;
            bottom: 4em;
            left: 0;
            right: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1em 2em;
			
			background-image: url('images/anemone_background.png');
			background-size: cover;
			background-position: center;
			background-repeat: no-repeat;
        }

        .character {
            width: 18em;
            height: 18em;
            background-image: url('images/anemone_main.png');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            animation: sway 3s ease-in-out infinite;
            filter: drop-shadow(0 0.4em 1em rgba(0, 0, 0, 0.15));
            transition: background-image 0.5s ease;
        }

        @keyframes sway {
            0%, 100% { transform: translateX(0) rotate(-1deg); }
            50% { transform: translateX(0.5em) rotate(1deg); }
        }

        .dialogue-container {
            position: absolute;
            bottom: 2em;
            left: 0;
            right: 0;
            background: white;
            border-radius: 1.5em 1.5em 1.5em 1.5em;
            padding: 1.5em;
            box-shadow: 
                0 -0.4em 1.2em rgba(0, 0, 0, 0.1),
                inset 0 0.06em 0 rgba(255, 255, 255, 0.7);
        }

        .dialogue-text {
            font-size: 1em;
            line-height: 1.5;
            color: #2D3748;
            margin-bottom: 1em;
            min-height: 3.5em;
            display: flex;
            align-items: center;
            font-weight: 500;
        }

        .dialogue-text.success {
            color: #22c55e;
            font-weight: 600;
        }

        .dialogue-actions {
            display: flex;
            gap: 0.8em;
            justify-content: flex-end;
            align-items: center;
        }

        .next-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50%;
            width: 2.5em;
            height: 2.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 0.3em 0.8em rgba(102, 126, 234, 0.3),
                inset 0 0.06em 0 rgba(255, 255, 255, 0.2);
        }

        .next-btn:hover:not(:disabled) {
            transform: translateY(-0.12em) scale(1.05);
            box-shadow: 
                0 0.75em 1.5em rgba(102, 126, 234, 0.4),
                inset 0 0.06em 0 rgba(255, 255, 255, 0.3);
        }
        
        .next-btn:disabled {
            cursor: not-allowed;
            background: #ccc;
        }

        .action-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            border: none;
            border-radius: 1.2em;
            padding: 0.8em 1.5em;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            box-shadow: 0 0.37em 0.9em rgba(72, 187, 120, 0.3);
        }

        .action-btn:hover:not(:disabled) {
            transform: translateY(-0.06em);
            box-shadow: 0 0.5em 1.2em rgba(72, 187, 120, 0.4);
        }

        .action-btn:disabled {
            background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);
            box-shadow: 0 0.37em 0.9em rgba(159, 122, 234, 0.3);
        }

        .action-btn.secondary:hover:not(:disabled) {
            box-shadow: 0 0.5em 1.2em rgba(159, 122, 234, 0.4);
        }

        .action-btn.danger {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            box-shadow: 0 0.37em 0.9em rgba(229, 62, 62, 0.3);
        }

        .action-btn.danger:hover:not(:disabled) {
            box-shadow: 0 0.5em 1.2em rgba(229, 62, 62, 0.4);
        }

        /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
        .input-container {
            display: flex;
            align-items: center;
            gap: 0.5em;
            margin: 1em 0;
        }

        .input-field {
            padding: 0.5em;
            border: 2px solid #cbd5e0;
            border-radius: 0.5em;
            font-size: 1em;
            width: 6em;
            text-align: center;
        }

        .confirm-btn {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            border: none;
            border-radius: 0.8em;
            padding: 0.5em 1em;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .confirm-btn:hover {
            transform: translateY(-0.06em);
        }

        /* ì´ë²¤íŠ¸ ëª¨ë‹¬ */
        .event-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 2em;
        }

        .event-content {
            background: white;
            padding: 2em;
            border-radius: 1.5em;
            box-shadow: 0 1.2em 2.4em rgba(0, 0, 0, 0.3);
            position: relative;
            width: 90%;
            max-width: 35em;
            max-height: 80%;
        }

        /* ì„ íƒí˜• ì´ë²¤íŠ¸ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .choice-event-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 2em;
        }

        .choice-event-content {
            background: white;
            border-radius: 1.5em;
            box-shadow: 0 1.2em 2.4em rgba(0, 0, 0, 0.3);
            position: relative;
            width: 90%;
            max-width: 50em;
            height: 80%;
            max-height: 35em;
            display: flex;
            overflow: hidden;
        }

        .choice-event-image {
            flex: 1;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 1.5em 0 0 1.5em;
        }

        .choice-event-right {
            flex: 1;
            padding: 2em;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .choice-event-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #2D3748;
            margin-bottom: 1.5em;
            flex-grow: 1;
            display: flex;
            align-items: center;
        }

        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 1em;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .choice-buttons.show {
            opacity: 1;
        }

        .choice-btn {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            border: none;
            border-radius: 1em;
            padding: 1em 1.5em;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            text-align: left;
        }

        .choice-btn:hover {
            transform: translateY(-0.06em);
            box-shadow: 0 0.5em 1.2em rgba(66, 153, 225, 0.4);
        }

        .choice-btn:nth-child(2) {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .choice-btn:nth-child(2):hover {
            box-shadow: 0 0.5em 1.2em rgba(72, 187, 120, 0.4);
        }

        .event-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #2D3748;
            margin-bottom: 1.5em;
            min-height: 4em;
        }

        .event-text.positive {
            color: #2563eb;
        }

        .event-text.negative {
            color: #dc2626;
        }

        .event-next-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: none;
            border-radius: 50%;
            width: 3em;
            height: 3em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
            transition: all 0.3s ease;
            margin: 0 auto;
        }

        .event-next-btn:hover {
            transform: scale(1.1);
        }

       /* ë¯¸ë‹ˆê²Œì„ ì˜ì—­ */
        .minigame-area {
            position: relative;
            width: calc(100% - 2em);
            max-width: calc(100% - 2em);
            height: 18em;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            border-radius: 1.2em;
            margin: 0.5em 1em;
            margin-top: -50px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 0.8em 1em 0em 1em;
            box-shadow: 
                0 0.5em 1em rgba(0, 0, 0, 0.3),
                inset 0 0.2em 0 rgba(255, 255, 255, 0.1);
        }

        .slot-row {
            display: flex;
            align-items: center;
            margin-bottom: 1.5em;
            width: 100%;
            max-width: 50em;
        }

        .slot-row:last-child {
            margin-bottom: 2em;
        }

        .slot-container-horizontal {
            display: flex;
            gap: 1em;
            flex: 1;
            justify-content: center;
        }

        .slot-item {
            position: relative;
            width: 12em;
            height: 8em;
            border: 3px solid #60a5fa;
            border-radius: 1em;
            background: linear-gradient(145deg, #f8fafc 0%, #e2e8f0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 
                0 1em 2em rgba(96, 165, 250, 0.2),
                inset 0 0.1em 0 rgba(255, 255, 255, 0.8),
                inset 0 -0.1em 0 rgba(0, 0, 0, 0.1);
            transform-style: preserve-3d;
        }

        .slot-item:hover {
            transform: translateY(-0.2em);
            box-shadow: 
                0 1.5em 3em rgba(96, 165, 250, 0.3),
                inset 0 0.1em 0 rgba(255, 255, 255, 0.9),
                inset 0 -0.1em 0 rgba(0, 0, 0, 0.1);
        }

        .slot-item.spinning {
            border-color: #f59e0b;
            box-shadow: 
                0 1em 2em rgba(245, 158, 11, 0.3),
                inset 0 0.1em 0 rgba(255, 255, 255, 0.8),
                inset 0 -0.1em 0 rgba(0, 0, 0, 0.1),
                0 0 2em rgba(245, 158, 11, 0.4);
            animation: slotGlow 0.5s ease-in-out infinite alternate;
        }

        @keyframes slotGlow {
            from { 
                box-shadow: 
                    0 1em 2em rgba(245, 158, 11, 0.3),
                    inset 0 0.1em 0 rgba(255, 255, 255, 0.8),
                    inset 0 -0.1em 0 rgba(0, 0, 0, 0.1),
                    0 0 2em rgba(245, 158, 11, 0.4);
            }
            to { 
                box-shadow: 
                    0 1em 2em rgba(245, 158, 11, 0.5),
                    inset 0 0.1em 0 rgba(255, 255, 255, 0.9),
                    inset 0 -0.1em 0 rgba(0, 0, 0, 0.1),
                    0 0 3em rgba(245, 158, 11, 0.6);
            }
        }

        .slot-image {
            width: 90%;
            height: 90%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            transition: all 0.1s ease;
            filter: drop-shadow(0 0.2em 0.5em rgba(0, 0, 0, 0.2));
        }

        .slot-arrow {
            position: absolute;
            top: -2.5em;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5em;
            color: #f59e0b;
            text-shadow: 
                0 0.1em 0.2em rgba(0, 0, 0, 0.3),
                0 0 1em rgba(245, 158, 11, 0.6);
            animation: arrowBounce 0.8s ease-in-out infinite;
        }

        @keyframes arrowBounce {
            0%, 100% { 
                transform: translateX(-50%) translateY(0) scale(1);
                text-shadow: 
                    0 0.1em 0.2em rgba(0, 0, 0, 0.3),
                    0 0 1em rgba(245, 158, 11, 0.6);
            }
            50% { 
                transform: translateX(-50%) translateY(-0.3em) scale(1.1);
                text-shadow: 
                    0 0.2em 0.4em rgba(0, 0, 0, 0.4),
                    0 0 1.5em rgba(245, 158, 11, 0.8);
            }
        }

        .slot-label {
            color: #f8fafc;
            font-size: 1.2em;
            font-weight: 700;
            text-shadow: 0 0.1em 0.2em rgba(0, 0, 0, 0.5);
            min-width: 6em;
            text-align: center;
            padding: 0 1em;
        }

        .slot-controls {
            display: flex;
            gap: 1.5em;
            justify-content: center;
            width: 100%;
        }

        .stop-btn {
            background: linear-gradient(145deg, #dc2626 0%, #b91c1c 50%, #991b1b 100%);
            border: none;
            border-radius: 1.2em;
            padding: 1em 2.5em;
            color: white;
            font-weight: 700;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            box-shadow: 
                0 0.8em 1.5em rgba(220, 38, 38, 0.4),
                inset 0 0.1em 0 rgba(255, 255, 255, 0.2),
                inset 0 -0.1em 0 rgba(0, 0, 0, 0.2);
            text-shadow: 0 0.1em 0.2em rgba(0, 0, 0, 0.3);
            transform-style: preserve-3d;
            position: relative;
        }

        .stop-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(145deg, transparent 0%, rgba(255, 255, 255, 0.1) 50%, transparent 100%);
            border-radius: 1.2em;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stop-btn:hover:not(:disabled) {
            transform: translateY(-0.3em) scale(1.05);
            box-shadow: 
                0 1.2em 2.5em rgba(220, 38, 38, 0.5),
                inset 0 0.1em 0 rgba(255, 255, 255, 0.3),
                inset 0 -0.1em 0 rgba(0, 0, 0, 0.2);
        }

        .stop-btn:hover:not(:disabled)::before {
            opacity: 1;
        }

        .stop-btn:active:not(:disabled) {
            transform: translateY(-0.1em) scale(1.02);
            box-shadow: 
                0 0.5em 1em rgba(220, 38, 38, 0.6),
                inset 0 0.1em 0 rgba(255, 255, 255, 0.4),
                inset 0 -0.1em 0 rgba(0, 0, 0, 0.3);
        }

        .stop-btn:disabled {
            background: linear-gradient(145deg, #6b7280 0%, #4b5563 50%, #374151 100%);
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
            box-shadow: 
                0 0.3em 0.8em rgba(107, 114, 128, 0.3),
                inset 0 0.1em 0 rgba(255, 255, 255, 0.1),
                inset 0 -0.1em 0 rgba(0, 0, 0, 0.2);
        }

        .stop-btn:disabled::before {
            opacity: 0;
        }

        .minigame-title {
            color: #f8fafc;
            font-size: 1.5em;
            font-weight: 800;
            text-align: center;
            margin-bottom: 2em;
            text-shadow: 
                0 0.1em 0.2em rgba(0, 0, 0, 0.5),
                0 0 1em rgba(96, 165, 250, 0.3);
            letter-spacing: 0.05em;
        }

        /* ê·¸ë˜í”„ ëª¨ë‹¬ */
        .graph-modal, .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 2em;
        }

        .history-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 2em;
        }

        .graph-content, .loading-content {
            background: white;
            padding: 2em;
            border-radius: 1.5em;
            box-shadow: 0 1.2em 2.4em rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .graph-content { 
            width: 90%; 
            max-width: 35em; 
            max-height: 80%;
        }
        
        .loading-content { 
            text-align: center; 
            font-size: 2em; 
            font-weight: 700; 
            color: #2D3748; 
            padding: 2em;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1.5em;
            box-shadow: 0 1.2em 2.4em rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
        }

        .graph-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5em;
        }

        .graph-title { 
            font-size: 1.3em; 
            font-weight: 700; 
            color: #2D3748; 
        }

        .close-btn {
            background: #e53e3e; 
            border: none; 
            border-radius: 50%; 
            width: 2em; 
            height: 2em;
            color: white; 
            cursor: pointer; 
            font-size: 1.2em; 
            transition: all 0.3s ease;
        }
        
        .close-btn:hover { 
            background: #c53030; 
            transform: scale(1.1); 
        }

        .history-content {
            max-height: 300px; 
            overflow-y: auto; 
            padding: 1em; 
            background: #f7fafc; 
            border-radius: 0.5em; 
            font-family: monospace; 
            line-height: 1.5;
            white-space: pre-line;
        }

        .typing-cursor { 
            animation: blink 1s infinite; 
        }
        
        @keyframes blink { 
            0%, 50% { opacity: 1; } 
            51%, 100% { opacity: 0; } 
        }

        /* ê²Œì„ ê²°ê³¼ ì• ë‹ˆë©”ì´ì…˜ */
        .result-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            font-weight: 900;
            text-align: center;
            z-index: 100;
            animation: resultPop 2s ease-out;
            pointer-events: none;
        }

        .result-animation.success {
            color: #22c55e;
            text-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
        }

        .result-animation.failure {
            color: #ef4444;
            text-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }

        @keyframes resultPop {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(0deg);
                opacity: 1;
            }
            80% {
                transform: translate(-50%, -50%) scale(1.1) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 0;
            }
        }

        /* ê²°ê³¼ ì´ë¯¸ì§€ */
        .result-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20em;
            height: 20em;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            z-index: 99;
            animation: resultImagePop 3s ease-out;
            pointer-events: none;
        }

        @keyframes resultImagePop {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            20% {
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 1;
            }
            80% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="status-bar">
            <button class="back-btn" id="backBtn">â†</button>
            <div class="status-info" id="statusInfo">
                <div class="status-display" id="yearDisplay">0ë…„ì°¨</div>
                <div class="status-display" id="populationDisplay">ê°œì²´ìˆ˜: 50ë§ˆë¦¬</div>
                <div class="status-display" id="foodDisplay">í”Œë‘í¬í†¤: -ë§ˆë¦¬</div>
                <div class="status-display" id="tempDisplay">ìˆ˜ì˜¨: -Â°C</div>
                <button class="graph-btn" id="graphBtn" disabled>ê°œì²´ìˆ˜ ê·¸ë˜í”„</button>
            </div>
        </div>

        <div class="character-area" id="characterArea">
            <div class="character" id="character"></div>
        </div>

        <div class="dialogue-container" id="dialogueContainer">
            <div class="dialogue-text" id="dialogueText"></div>
            <div class="dialogue-actions" id="dialogueActions">
                <button class="next-btn" id="nextBtn">ğŸ”½</button>
            </div>
        </div>

        <!-- ê¸°ì¡´ ì´ë²¤íŠ¸ ëª¨ë‹¬ (ì•Œë¦¼í˜•) -->
        <div class="event-modal" id="eventModal">
            <div class="event-content">
                <div class="event-text" id="eventText"></div>
                <div id="eventActions">
                    <button class="event-next-btn" id="eventNextBtn">â–¼</button>
                </div>
            </div>
        </div>

        <!-- ìƒˆë¡œìš´ ì„ íƒí˜• ì´ë²¤íŠ¸ ëª¨ë‹¬ -->
        <div class="choice-event-modal" id="choiceEventModal">
            <div class="choice-event-content">
                <div class="choice-event-image" id="choiceEventImage"></div>
                <div class="choice-event-right">
                    <div class="choice-event-text" id="choiceEventText"></div>
                    <div class="choice-buttons" id="choiceButtons">
                        <button class="choice-btn" id="choice1Btn"></button>
                        <button class="choice-btn" id="choice2Btn"></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê·¸ë˜í”„ ëª¨ë‹¬ -->
        <div class="graph-modal" id="graphModal">
             <div class="graph-content">
                <div class="graph-header">
                    <div class="graph-title">ê°œì²´ìˆ˜ ë³€í™” ê·¸ë˜í”„</div>
                    <button class="close-btn" id="closeGraphBtn">Ã—</button>
                </div>
                <canvas class="graph-canvas" id="graphCanvas" style="width: 100%; height: 20em; border: 1px solid #e2e8f0; border-radius: 0.5em;"></canvas>
            </div>
        </div>

        <!-- íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ -->
        <div class="history-modal" id="historyModal">
             <div class="graph-content">
                <div class="graph-header">
                    <div class="graph-title">íˆìŠ¤í† ë¦¬</div>
                    <button class="close-btn" id="closeHistoryBtn">Ã—</button>
                </div>
                <div class="history-content" id="historyContent"></div>
            </div>
        </div>

        <!-- ë¡œë”© ëª¨ë‹¬ -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content" id="loadingText">ì‹œê°„ì´ íë¥´ê³  ìˆì–´...</div>
        </div>
    </div>

    <script>
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            currentYear: 0,
            population: 50,
            food: 0, // í”Œë‘í¬í†¤ ê°œì²´ìˆ˜
            temperature: 0, // ìˆ˜ì˜¨
            stress: 0, // ì˜¨ë„ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜
            populationHistory: [50],
            foodHistory: [],
            temperatureHistory: [],
            historyEvents: [],
            dialogueStep: 0,
            isTyping: false,
            gameEnded: false,
            dialogueComplete: false,
            hermitCrabPartner: false, // ì†Œë¼ê²Œ ì§ê¿ ì—¬ë¶€
            clownfishPartner: false // í°ë™ê°€ë¦¬ ê³µìƒ ì—¬ë¶€
        };

        // DOM ìš”ì†Œë“¤
        const dialogueTextEl = document.getElementById('dialogueText');
        const dialogueActionsEl = document.getElementById('dialogueActions');
        const characterEl = document.getElementById('character');
        const yearDisplayEl = document.getElementById('yearDisplay');
        const populationDisplayEl = document.getElementById('populationDisplay');
        const foodDisplayEl = document.getElementById('foodDisplay');
        const tempDisplayEl = document.getElementById('tempDisplay');
        const graphBtnEl = document.getElementById('graphBtn');
        const backBtnEl = document.getElementById('backBtn');
        const eventModalEl = document.getElementById('eventModal');
        const eventTextEl = document.getElementById('eventText');
        const eventActionsEl = document.getElementById('eventActions');
        const choiceEventModalEl = document.getElementById('choiceEventModal');
        const choiceEventImageEl = document.getElementById('choiceEventImage');
        const choiceEventTextEl = document.getElementById('choiceEventText');
        const choiceButtonsEl = document.getElementById('choiceButtons');
        const graphModalEl = document.getElementById('graphModal');
        const historyModalEl = document.getElementById('historyModal');
        const loadingOverlayEl = document.getElementById('loadingOverlay');
        const historyContentEl = document.getElementById('historyContent');

        // ì´ˆê¸° ëŒ€ì‚¬
        const initialDialogues = [
            "íë¬¼íë¬¼. ë‚˜ëŠ” ê·€ì—¬ìš´ ë§ë¯¸ì˜ì´ì•¼.",
            "ì—¬ê¸°ëŠ”â€¦ ì˜¨ê°– í˜¹ë…í•œ ì‹œë ¨ì´ ì°¾ì•„ì˜¤ëŠ” í˜„ì‹¤ì´ì§€â€¦",
            "ìš°ë¦¬ ë§ë¯¸ì˜ ê°œì²´êµ°ì€ ì§€ê¸ˆ 50ë§ˆë¦¬ê°€ ìˆì–´.",
            "ìš°ë¦¬ ë§ë¯¸ì˜ì€ í”Œë‘í¬í†¤ì„ ë¨¹ê³  ì‚´ì§€. ì§€ê¸ˆ ë°”ë‹·ì† í”Œë‘í¬í†¤ì€ ì–¼ë§ˆë‚˜ ë§ì´ ìˆì„ê¹Œ?"
        ];

        // íš¨ê³¼ìŒ í•¨ìˆ˜
        const audioFiles = {
            positive: new Audio('audio/positive.mp3'),
            negative: new Audio('audio/negative.mp3'),
            success: new Audio('audio/success.mp3'),
            failure: new Audio('audio/failure.mp3')
        };

        // ëª¨ë“  ì˜¤ë””ì˜¤ íŒŒì¼ ë¯¸ë¦¬ ë¡œë“œ
        Object.values(audioFiles).forEach(audio => {
            audio.preload = 'auto';
        });

        // íš¨ê³¼ìŒ ì¬ìƒ í•¨ìˆ˜ë“¤
        function playPositiveSound() {
            audioFiles.positive.currentTime = 0;
            audioFiles.positive.play().catch(e => console.log('ê¸ì • íš¨ê³¼ìŒ ì¬ìƒ ì˜¤ë¥˜:', e));
        }

        function playNegativeSound() {
            audioFiles.negative.currentTime = 0;
            audioFiles.negative.play().catch(e => console.log('ë¶€ì • íš¨ê³¼ìŒ ì¬ìƒ ì˜¤ë¥˜:', e));
        }

        function playSuccessSound() {
            audioFiles.success.currentTime = 0;
            audioFiles.success.play().catch(e => console.log('ì„±ê³µ íš¨ê³¼ìŒ ì¬ìƒ ì˜¤ë¥˜:', e));
        }

        function playFailureSound() {
            audioFiles.failure.currentTime = 0;
            audioFiles.failure.play().catch(e => console.log('ì‹¤íŒ¨ íš¨ê³¼ìŒ ì¬ìƒ ì˜¤ë¥˜:', e));
        }

        // íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜
        function typeText(element, text, callback, className = '') {
            if (gameState.isTyping) return;
            
            gameState.isTyping = true;
            if (className) {
                element.className = className;
            }
            element.innerHTML = '';
            let i = 0;
            const cursor = '<span class="typing-cursor">|</span>';
            
            function type() {
                if (i < text.length) {
                    element.innerHTML = text.substring(0, i + 1) + cursor;
                    i++;
                    setTimeout(type, 50);
                } else {
                    element.innerHTML = text;
                    gameState.isTyping = false;
                    if (callback) callback();
                }
            }
            type();
        }

        // ëŒ€ì‚¬ ì§„í–‰
        function nextDialogue() {
            if (gameState.isTyping) return;
            
            if (gameState.dialogueStep < initialDialogues.length) {
                typeText(dialogueTextEl, initialDialogues[gameState.dialogueStep], () => {
                    // ë§ˆì§€ë§‰ ëŒ€ì‚¬("ìš°ë¦¬ ë§ë¯¸ì˜ì€ í”Œë‘í¬í†¤ì„ ë¨¹ê³  ì‚´ì§€...") í›„ í”Œë‘í¬í†¤ ì…ë ¥ì°½ í‘œì‹œ
                    if (gameState.dialogueStep === initialDialogues.length) {
                        showFoodInput();
                    }
                });
                gameState.dialogueStep++;
            } else if (gameState.dialogueStep === initialDialogues.length) {
                // í”Œë‘í¬í†¤ ê°œì²´ìˆ˜ ì„¤ì • í›„
                const afterFoodText = `ì§€ê¸ˆ í”Œë‘í¬í†¤ì€ ${gameState.food}ë§ˆë¦¬ ìˆêµ¬ë‚˜!`;
                typeText(dialogueTextEl, afterFoodText, () => {
                    gameState.dialogueStep++;
                });
            } else if (gameState.dialogueStep === initialDialogues.length + 1) {
                typeText(dialogueTextEl, "ì˜¬í•´ ìš°ë¦¬ ë°”ë‹¤ ìƒíƒœê³„ì˜ í‰ê·  ìˆ˜ì˜¨ì€ ì–¼ë§ˆì˜€ì„ê¹Œ?", () => {
                    showTemperatureInput();
                });
            } else if (gameState.dialogueStep === initialDialogues.length + 2) {
                typeText(dialogueTextEl, "ì–´ë–¤ ì–´ë ¤ì›€ì´ ì°¾ì•„ì˜¬ì§€ ëª¨ë¥´ê² ì§€ë§Œ, ë‚´ ë§ë¯¸ì˜ìƒì˜ ëª©í‘œëŠ”!", () => {
                    gameState.dialogueStep++;
                });
            } else if (gameState.dialogueStep === initialDialogues.length + 3) {
                typeText(dialogueTextEl, "ìš°ë¦¬ ë§ë¯¸ì˜ ê°œì²´êµ°ì´ ì•ˆì •ì ìœ¼ë¡œ ì˜ ìœ ì§€ë˜ëŠ” ê±°ì•¼. ê·¸ëŸ´ ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤˜! ì˜ ë¶€íƒí•´!", () => {
                    gameState.dialogueComplete = true;
                    showGameActions();
                    enableButtons();
                });
            }
        }

        // í”Œë‘í¬í†¤ ê°œì²´ìˆ˜ ì…ë ¥ì°½ í‘œì‹œ
        function showFoodInput() {
            dialogueActionsEl.innerHTML = `
                <div class="input-container">
                    <span>í”Œë‘í¬í†¤ ê°œì²´ìˆ˜:</span>
                    <input type="number" id="foodInput" class="input-field" min="5" max="500" placeholder="5-500">
                    <button class="confirm-btn" onclick="setFoodCount()">í™•ì¸</button>
                </div>
            `;
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.style.display = 'none';
            }
        }

        // ìˆ˜ì˜¨ ì…ë ¥ì°½ í‘œì‹œ
        function showTemperatureInput() {
            dialogueActionsEl.innerHTML = `
                <div class="input-container">
                    <span>ìˆ˜ì˜¨:</span>
                    <input type="number" id="tempInput" class="input-field" min="15" max="45" placeholder="15-45Â°C">
                    <button class="confirm-btn" onclick="setTemperature()">í™•ì¸</button>
                </div>
            `;
        }

        // í”Œë‘í¬í†¤ ê°œì²´ìˆ˜ ì„¤ì •
        function setFoodCount() {
            const foodInput = document.getElementById('foodInput');
            const value = parseInt(foodInput.value);
            
            if (isNaN(value) || value < 5 || value > 500) {
                alert('5~500 ë²”ìœ„ ë‚´ì—ì„œ ì„¤ì •í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            gameState.food = value;
            gameState.foodHistory = [value];
            updateDisplay();
            
            dialogueActionsEl.innerHTML = `<button class="next-btn" id="nextBtn">ğŸ”½</button>`;
            document.getElementById('nextBtn').addEventListener('click', nextDialogue);
            nextDialogue();
        }

        // ìˆ˜ì˜¨ ì„¤ì • (0ë…„ì°¨ ì´ˆê¸° ì„¤ì •)
        function setTemperature() {
            const tempInput = document.getElementById('tempInput');
            const value = parseInt(tempInput.value);
            
            if (isNaN(value) || value < 15 || value > 45) {
                alert('15~45Â°C ë²”ìœ„ ë‚´ì—ì„œ ì„¤ì •í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            gameState.temperature = value;
            gameState.temperatureHistory = [value];
            updateDisplay();
            
            // 0ë…„ì°¨ ì˜¨ë„ê°€ 1ë…„ì°¨ì— ë¯¸ì¹  ì˜í–¥ì„ íˆìŠ¤í† ë¦¬ì— ë¯¸ë¦¬ ë“±ë¡
            calculateTemperatureStressForNextYear();
            
            // ë‹¤ìŒ ëŒ€í™”ë¡œ ì§„í–‰
            gameState.dialogueStep++;
            
            dialogueActionsEl.innerHTML = `<button class="next-btn" id="nextBtn">ğŸ”½</button>`;
            document.getElementById('nextBtn').addEventListener('click', nextDialogue);
            nextDialogue();
        }

        // ê²Œì„ ì•¡ì…˜ ë²„íŠ¼ í‘œì‹œ
        function showGameActions() {
            if (gameState.currentYear >= 1) {
                // 1ë…„ì°¨ë¶€í„°ëŠ” íˆìŠ¤í† ë¦¬ ë²„íŠ¼ë„ í•¨ê»˜ í‘œì‹œ
                dialogueActionsEl.innerHTML = `
                    <button class="action-btn" id="nextYearBtn">1ë…„ í›„~</button>
                    <button class="next-btn" id="showHistoryBtn" title="íˆìŠ¤í† ë¦¬">ğŸ“‹</button>
                `;
            } else {
                // 0ë…„ì°¨ì—ëŠ” íˆìŠ¤í† ë¦¬ ë²„íŠ¼ ì—†ìŒ
                dialogueActionsEl.innerHTML = `
                    <button class="action-btn" id="nextYearBtn">1ë…„ í›„~</button>
                `;
            }
            document.getElementById('nextYearBtn').addEventListener('click', nextYear);
            if (gameState.currentYear >= 1) {
                document.getElementById('showHistoryBtn').addEventListener('click', showHistory);
            }
        }

        // 1ë…„ ì§„í–‰
        function nextYear() {
            if (!gameState.dialogueComplete || gameState.gameEnded) return;
            
            showLoading();
            setTimeout(() => {
                // ì—°ì°¨ ì¦ê°€ëŠ” ì—¬ê¸°ì„œë§Œ ë°œìƒ
                gameState.currentYear++;
                
                // ì´ì „ ì—°ì°¨ì˜ ì˜¨ë„ë¡œ ì¸í•œ ìŠ¤íŠ¸ë ˆìŠ¤ ì ìš© (ì‹¤ì œ ìŠ¤íŠ¸ë ˆìŠ¤ ê°’ ì—…ë°ì´íŠ¸)
                if (gameState.temperatureHistory[gameState.currentYear - 1] !== undefined) {
                    calculateTemperatureStress(gameState.temperatureHistory[gameState.currentYear - 1]);
                }
                
                // íŠ¹ë³„ ì´ë²¤íŠ¸ ì²´í¬
                if (gameState.currentYear === 2) {
                    // 2ë…„ì°¨ ì†Œë¼ê²Œ ì°¾ê¸° ì´ë²¤íŠ¸
                    hideLoading();
                    showHermitCrabEvent();
                    return;
                } else if (gameState.currentYear === 4) {
                    // 4ë…„ì°¨ í°ë™ê°€ë¦¬ ê³µìƒ ì´ë²¤íŠ¸
                    hideLoading();
                    showClownfishEvent();
                    return;
                } else if (gameState.currentYear === 6) {
                    // 6ë…„ì°¨ ì†Œë¼ê²Œ ë°°ì‹  ì´ë²¤íŠ¸
                    hideLoading();
                    showHermitCrabBetrayalEvent();
                    return;
                }
                
                // ê¸°ë³¸ ìƒíƒœê³„ ì‹œë®¬ë ˆì´ì…˜
                simulateEcosystem();
                
                // íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸ (ì—°ì°¨ê°€ ë°”ë€ í›„)
                gameState.populationHistory.push(gameState.population);
                gameState.foodHistory.push(gameState.food);
                
                // ê²Œì„ ì¢…ë£Œ ì¡°ê±´ í™•ì¸ (10ë…„ì°¨ì—ì„œ ë)
                if (gameState.population <= 5) {
                    showExtinctionEnding();
                } else if (gameState.currentYear >= 10) {
                    showSuccessEnding();
                } else {
                    showYearlyDialogue();
                }
                
                updateDisplay();
                hideLoading();
            }, 1500);
        }

        // ì˜¨ë„ ìŠ¤íŠ¸ë ˆìŠ¤ ê³„ì‚° ë° ì ìš© (ì—°ì°¨ ì§„í–‰ ì‹œ - ì´ì „ ì—°ì°¨ ì˜¨ë„ì˜ ì˜í–¥)
        function calculateTemperatureStress(temperature) {
            const T = temperature;
            let stressChange = 0;
            
            // ê³ ì˜¨ ìŠ¤íŠ¸ë ˆìŠ¤
            const excess_hot = Math.max(0, T - 28);
            stressChange += 1 * excess_hot;
            if (T >= 31) {
                stressChange += 1 * (T - 31);
            }
            
            // ì €ì˜¨ ìŠ¤íŠ¸ë ˆìŠ¤
            const excess_cold = Math.max(0, 18 - T);
            stressChange += 0.5 * excess_cold;
            
            // ìŠ¤íŠ¸ë ˆìŠ¤ ì ìš©
            gameState.stress += stressChange;
            
            // íšŒë³µ
            if (T < 28) {
                gameState.stress = Math.max(0, gameState.stress - 5);
            }
            
            // ìŠ¤íŠ¸ë ˆìŠ¤ì— ë”°ë¥¸ ê°œì²´ìˆ˜ ë³€í™”ë§Œ ì²˜ë¦¬ (íˆìŠ¤í† ë¦¬ëŠ” ì´ë¯¸ ì´ì „ì— ì¶”ê°€ë¨)
            if (gameState.stress >= 12) {
                gameState.population *= 0.4; // 60% ê°ì†Œ
            } else if (gameState.stress >= 8) {
                gameState.population *= 0.6; // 40% ê°ì†Œ
            } else if (gameState.stress >= 4) {
                gameState.population *= 0.8; // 20% ê°ì†Œ
            }
        }

        // ë¡œíŠ¸ì¹´-ë³¼í…Œë¼ ë°©ì •ì‹ì„ ì´ìš©í•œ ìƒíƒœê³„ ì‹œë®¬ë ˆì´ì…˜
        function simulateEcosystem() {
            const prevPopulation = gameState.population;
            const prevFood = gameState.food;
            
            // ë¡œíŠ¸ì¹´-ë³¼í…Œë¼ ë°©ì •ì‹ ë§¤ê°œë³€ìˆ˜
            const alpha = 0.3;     // í”Œë‘í¬í†¤ ì„±ì¥ë¥ 
            const beta = 0.001;    // í”Œë‘í¬í†¤-ë§ë¯¸ì˜ ìƒí˜¸ì‘ìš© ê³„ìˆ˜
            const gamma = 0.2;     // ë§ë¯¸ì˜ ìì—° ì‚¬ë§ë¥ 
            const delta = 0.0008;  // ë§ë¯¸ì˜-í”Œë‘í¬í†¤ ìƒí˜¸ì‘ìš© ê³„ìˆ˜
            
            // í˜„ì¬ ê°œì²´ìˆ˜
            let P = gameState.food;       // í”Œë‘í¬í†¤ ê°œì²´ìˆ˜ (ë¨¹ì´)
            let A = gameState.population; // ë§ë¯¸ì˜ ê°œì²´ìˆ˜ (í¬ì‹ì)
            
            // ë¡œíŠ¸ì¹´-ë³¼í…Œë¼ ë°©ì •ì‹ ì ìš© (ì°¨ë¶„ë°©ì •ì‹ìœ¼ë¡œ ê·¼ì‚¬)
            const dt = 0.1; // 0.1ë…„ ë‹¨ìœ„
            for (let step = 0; step < 10; step++) {
                const dP_dt = alpha * P - beta * P * A;
                const dA_dt = delta * P * A - gamma * A;
                P += dP_dt * dt;
                A += dA_dt * dt;
            }
            
            let newFood = P;
            let newPopulation = A;
            
            // ê²½ê³„ ì¡°ê±´ (0 ì´í•˜ë¡œëŠ” ê°€ì§€ ì•Šë„ë¡)
            newFood = Math.max(0, newFood);
            newPopulation = Math.max(0, newPopulation);
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            gameState.food = newFood;
            gameState.population = newPopulation;
            
            // ì˜¨ë„ ìŠ¤íŠ¸ë ˆìŠ¤ëŠ” ë³„ë„ë¡œ ì ìš©í•˜ì§€ ì•ŠìŒ (ì—°ì°¨ë³„ ìˆ˜ì˜¨ ì„¤ì • ì‹œì—ë§Œ)
        }

        // ì—°ì°¨ë³„ ëŒ€ì‚¬ í‘œì‹œ
        function showYearlyDialogue(includeTemperature = false) {
            const currentPop = Math.floor(gameState.population);
            const prevPop = Math.floor(gameState.populationHistory[gameState.currentYear - 1] || currentPop);
            
            let dialogue = `ì§€ê¸ˆì€ ${gameState.currentYear}ë…„ì°¨ê³ , ìš°ë¦¬ ë§ë¯¸ì˜ ê°œì²´êµ°ì€ ${currentPop}ë§ˆë¦¬ê°€ ë˜ì—ˆì–´.`;
            
            // ì˜¨ë„ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë ¨ ëŒ€ì‚¬ (ì¡°ê±´ë¶€) - ì‘ë…„ ì˜¨ë„ í™•ì¸
            const lastYearTemp = gameState.temperatureHistory[gameState.currentYear - 1] || 25;
            const excess_hot = Math.max(0, lastYearTemp - 28);
            const excess_cold = Math.max(0, 18 - lastYearTemp);
            
            dialogueActionsEl.innerHTML = '';
            
            typeText(dialogueTextEl, dialogue, () => {
                if (excess_hot > 0 || excess_cold > 0) {
                    // ì˜¨ë„ ìŠ¤íŠ¸ë ˆìŠ¤ ëŒ€ì‚¬ê°€ ìˆìœ¼ë©´ â–¼ ë²„íŠ¼ìœ¼ë¡œ ìˆ˜ë™ ì§„í–‰
                    if (gameState.currentYear >= 1) {
                        dialogueActionsEl.innerHTML = `
                            <button class="next-btn" onclick="showTemperatureStressDialogue()">â–¼</button>
                            <button class="next-btn" id="showHistoryBtn" title="íˆìŠ¤í† ë¦¬">ğŸ“‹</button>
                        `;
                        document.getElementById('showHistoryBtn').addEventListener('click', showHistory);
                    } else {
                        dialogueActionsEl.innerHTML = `<button class="next-btn" onclick="showTemperatureStressDialogue()">â–¼</button>`;
                    }
                } else {
                    // ì˜¨ë„ ìŠ¤íŠ¸ë ˆìŠ¤ ëŒ€ì‚¬ê°€ ì—†ìœ¼ë©´ â–¼ ë²„íŠ¼ìœ¼ë¡œ ê°œì²´ìˆ˜ ëŒ€ì‚¬ ì§„í–‰
                    if (gameState.currentYear >= 1) {
                        dialogueActionsEl.innerHTML = `
                            <button class="next-btn" onclick="continueToPopulationDialogue()">â–¼</button>
                            <button class="next-btn" id="showHistoryBtn" title="íˆìŠ¤í† ë¦¬">ğŸ“‹</button>
                        `;
                        document.getElementById('showHistoryBtn').addEventListener('click', showHistory);
                    } else {
                        dialogueActionsEl.innerHTML = `<button class="next-btn" onclick="continueToPopulationDialogue()">â–¼</button>`;
                    }
                }
            });
            
            // ì˜¨ë„ ìŠ¤íŠ¸ë ˆìŠ¤ ëŒ€ì‚¬ í‘œì‹œ í•¨ìˆ˜
            window.showTemperatureStressDialogue = () => {
                typeText(dialogueTextEl, "ì‘ë…„ì—ëŠ” ìˆ˜ì˜¨ ë•Œë¬¸ì— ì‚´ê¸° ì¢€ í˜ë“¤ì—ˆì–´â€¦ ã… ã…  ë°±í™”í˜„ìƒì„ ê²ªì€ ì¹œêµ¬ë“¤ì´ ë§ì•„.", () => {
                    characterEl.style.backgroundImage = "url('images/anemone_white.png')";
                    if (gameState.currentYear >= 1) {
                        dialogueActionsEl.innerHTML = `
                            <button class="next-btn" onclick="continueToPopulationDialogue()">â–¼</button>
                            <button class="next-btn" id="showHistoryBtn" title="íˆìŠ¤í† ë¦¬">ğŸ“‹</button>
                        `;
                        document.getElementById('showHistoryBtn').addEventListener('click', showHistory);
                    } else {
                        dialogueActionsEl.innerHTML = `<button class="next-btn" onclick="continueToPopulationDialogue()">â–¼</button>`;
                    }
                });
            };
            
            // ê°œì²´ìˆ˜ ë³€í™” ëŒ€ì‚¬ë¥¼ ìœ„í•œ ì „ì—­ í•¨ìˆ˜
            window.continueToPopulationDialogue = () => {
                let populationDialogue = "";
                if (currentPop >= prevPop) {
                    populationDialogue = "ë‹¤í–‰íˆ ì•„ì§ ìš°ë¦¬ ë§ë¯¸ì˜ ê°œì²´êµ°ì€ ì˜ ì‚´ì•„ìˆì–´. ì•ìœ¼ë¡œë„ ì˜ ë¶€íƒí•´.";
                    if (excess_hot === 0 && excess_cold === 0) {
                        characterEl.style.backgroundImage = "url('images/anemone_happy.png')";
                    }
                } else {
                    populationDialogue = "ë‚˜ëŠ” ì•„ì§ ì‚´ì•„ìˆì§€ë§Œ.. ì¹œêµ¬ì™€ ê°€ì¡±ë“¤ì„ ì¡°ê¸ˆ ìƒì—ˆì–´. ğŸ¥º";
                    if (excess_hot === 0 && excess_cold === 0) {
                        characterEl.style.backgroundImage = "url('images/anemone_sad.png')";
                    }
                }
                
                typeText(dialogueTextEl, populationDialogue, () => {
                    if (gameState.currentYear >= 1) {
                        dialogueActionsEl.innerHTML = `
                            <button class="next-btn" onclick="showTemperatureInput()">â–¼</button>
                            <button class="next-btn" id="showHistoryBtn" title="íˆìŠ¤í† ë¦¬">ğŸ“‹</button>
                        `;
                        document.getElementById('showHistoryBtn').addEventListener('click', showHistory);
                    } else {
                        dialogueActionsEl.innerHTML = `<button class="next-btn" onclick="showTemperatureInput()">â–¼</button>`;
                    }
                });
            };
            
            // ìˆ˜ì˜¨ ì…ë ¥ í‘œì‹œ í•¨ìˆ˜
            window.showTemperatureInput = () => {
                typeText(dialogueTextEl, "ì˜¬í•´ ìš°ë¦¬ ë°”ë‹¤ ìƒíƒœê³„ì˜ í‰ê·  ìˆ˜ì˜¨ì€ ì–¼ë§ˆì˜€ì„ê¹Œ?", () => {
                    showYearlyTemperatureInput();
                });
            };
        }

        // ì—°ì°¨ë³„ ìˆ˜ì˜¨ ì…ë ¥ì°½
        function showYearlyTemperatureInput() {
            dialogueActionsEl.innerHTML = `
                <div class="input-container">
                    <span>ì˜¬í•´ ìˆ˜ì˜¨:</span>
                    <input type="number" id="yearlyTempInput" class="input-field" min="15" max="45" placeholder="15-45Â°C">
                    <button class="confirm-btn" onclick="setYearlyTemperature()">í™•ì¸</button>
                </div>
            `;
        }

        // ì—°ì°¨ë³„ ìˆ˜ì˜¨ ì„¤ì •
        function setYearlyTemperature() {
            const tempInput = document.getElementById('yearlyTempInput');
            const value = parseInt(tempInput.value);
            
            if (isNaN(value) || value < 15 || value > 45) {
                alert('15~45Â°C ë²”ìœ„ ë‚´ì—ì„œ ì„¤ì •í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            gameState.temperature = value;
            gameState.temperatureHistory[gameState.currentYear] = value; // í˜„ì¬ ì—°ì°¨ì— ì˜¨ë„ ì €ì¥
            updateDisplay(); // ìš°ì¸¡ ìƒë‹¨ ìˆ˜ì˜¨ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            
            // ë‹¤ìŒ ì—°ì°¨(n+1ë…„ì°¨)ì— ì˜í–¥ì„ ë¯¸ì¹  ì˜¨ë„ ìŠ¤íŠ¸ë ˆìŠ¤ ë¯¸ë¦¬ ê³„ì‚° ë° íˆìŠ¤í† ë¦¬ ì¶”ê°€
            calculateTemperatureStressForNextYear();
            
            // ì…ë ¥ì°½ ë¨¼ì € ì œê±°
            dialogueActionsEl.innerHTML = '';
            
            // ìˆ˜ì˜¨ í™•ì¸ ëŒ€ì‚¬
            const confirmText = `ì˜¬í•´ í‰ê·  ìˆ˜ì˜¨ì€ ${value}Â°C ì˜€êµ¬ë‚˜. ì¢‹ì•„. ë‹¤ìŒ í•´ë¡œ ë„˜ì–´ê°€ë³´ì.`;
            typeText(dialogueTextEl, confirmText, () => {
                // 7ë…„ì°¨ì¸ ê²½ìš° ì—˜ë‹ˆë‡¨ ì´ë²¤íŠ¸ ë°œìƒ
                if (gameState.currentYear === 7) {
                    setTimeout(() => {
                        showElNinoEvent();
                    }, 1000);
                } else {
                    // ì¼ë°˜ì ì¸ ì—°ì°¨ ì§„í–‰ ì™„ë£Œ - 1ë…„ í›„ ë²„íŠ¼ í™œì„±í™”
                    setTimeout(() => {
                        showGameActions();
                    }, 1000);
                }
            });
        }

        // ë‹¤ìŒ ì—°ì°¨ì˜ ì˜¨ë„ ìŠ¤íŠ¸ë ˆìŠ¤ ê³„ì‚° (íˆìŠ¤í† ë¦¬ ì „ìš© - në…„ì°¨ ì˜¨ë„ê°€ n+1ë…„ì°¨ì— ì˜í–¥)
        function calculateTemperatureStressForNextYear() {
            const T = gameState.temperature;
            let stressChange = 0;
            
            // ê³ ì˜¨ ìŠ¤íŠ¸ë ˆìŠ¤
            const excess_hot = Math.max(0, T - 28);
            stressChange += 1 * excess_hot;
            if (T >= 31) {
                stressChange += 1 * (T - 31);
            }
            
            // ì €ì˜¨ ìŠ¤íŠ¸ë ˆìŠ¤
            const excess_cold = Math.max(0, 18 - T);
            stressChange += 0.5 * excess_cold;
            
            // ìŠ¤íŠ¸ë ˆìŠ¤ ì ìš© (ë¯¸ë¦¬ ê³„ì‚°)
            let futureStress = gameState.stress + stressChange;
            
            // íšŒë³µ
            if (T < 28) {
                futureStress = Math.max(0, futureStress - 1);
            }
            
            // ë‹¤ìŒ ì—°ì°¨(n+1ë…„ì°¨)ì˜ ìŠ¤íŠ¸ë ˆìŠ¤ ìƒí™©ì„ íˆìŠ¤í† ë¦¬ì— ë¯¸ë¦¬ ê¸°ë¡
            const nextYear = gameState.currentYear + 1;
            
            // ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ìˆëŠ” ê²½ìš° íˆìŠ¤í† ë¦¬ ì¶”ê°€ (0ë…„ì°¨ë„ í¬í•¨)
            if (excess_hot > 0 || excess_cold > 0) {
                gameState.historyEvents.push(`${nextYear}ë…„ì°¨: ì˜¨ë„ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ ì¸í•œ ê°œì²´êµ° ìœ„ê¸° (í˜„ì¬ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜: ${Math.floor(futureStress)})`);
            } else if (futureStress > 0) {
                gameState.historyEvents.push(`${nextYear}ë…„ì°¨: ì ì • ìˆ˜ì˜¨ì—ë„ ë¶ˆêµ¬í•˜ê³ , ëˆ„ì ëœ ì˜¨ë„ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ ì¸í•œ ê°œì²´êµ° ìœ„ê¸° (í˜„ì¬ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜: ${Math.floor(futureStress)})`);
            }
            
            // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸ (ì œê±° ê°€ëŠ¥)
            console.log(`ì˜¨ë„ ${T}Â°C ì„¤ì • â†’ ${nextYear}ë…„ì°¨ ì˜ˆìƒ ìŠ¤íŠ¸ë ˆìŠ¤: ${Math.floor(futureStress)}, excess_hot: ${excess_hot}, excess_cold: ${excess_cold}`);
        }

        // 2ë…„ì°¨ ì†Œë¼ê²Œ ì°¾ê¸° ì´ë²¤íŠ¸
        function showHermitCrabEvent() {
            const eventSteps = [
                "ìš°ë¦¬ ë§ë¯¸ì˜ë“¤ì€ í•œë²ˆ ìë¦¬ì¡ìœ¼ë©´ ë°”ë‹¥ì— ë¶™ì–´ ê³ ì°©ìƒí™œì„ í•˜ê¸° ë•Œë¬¸ì— ì›€ì§ì´ê¸° í˜ë“¤ê³  ë¨¹ì´ë¥¼ ì¡ì•„ë¨¹ê¸°ê°€ í˜ë“¤ë‹¤.",
                "ì•—.. ì €ê¸° ë³´ì´ëŠ” ê²ƒì€ ì†Œë¼ê²Œ? ì†Œë¼ê²Œ ë¬´ë¦¬ê°€ ë§ë¯¸ì˜ì—ê²Œ ìì‹ ì˜ ë“±ì— íƒ€ë¼ë©° ì†ì„ ë‚´ë°€ì—ˆë‹¤.",
                "ì²˜ìŒ ë³¸ ìˆœê°„...~ ë‚˜ëŠ” ë¹ ì ¸ ë²„ë ¸ì–´...~ ì˜¤ë«ë™ì•ˆ ì°¾ê³  ì°¾ë˜ ì§ê¿ ì†Œë¼í•‘...~",
                "[ë¯¸ì…˜] ë‚˜ì˜ ì§ê¿ ì†Œë¼ê²Œë¥¼ ì°¾ì!",
                "'ë©ˆì¶¤' ë²„íŠ¼ì„ ëˆŒëŸ¬, ë‚´ ìš´ëª…ì˜ ì†Œë¼ê²Œë¥¼ ë§Œë‚˜ë³´ì„¸ìš”."
            ];
            
            let currentStep = 0;
            
            function showEventStep() {
                if (currentStep < eventSteps.length) {
                    typeText(eventTextEl, eventSteps[currentStep], () => {
                        currentStep++;
                        if (currentStep < eventSteps.length) {
                            eventActionsEl.innerHTML = `<button class="event-next-btn" onclick="showEventStep()">â–¼</button>`;
                        } else {
                            startHermitCrabMinigame();
                        }
                    });
                }
            }
            
            eventActionsEl.innerHTML = '';
            eventModalEl.style.display = 'flex';
            showEventStep();
            
            window.showEventStep = showEventStep;
        }

       // ì†Œë¼ê²Œ ë¯¸ë‹ˆê²Œì„ ì‹œì‘ (ì„ íƒ ìŠ¬ë¡¯ í…Œë‘ë¦¬ í‘œì‹œ)
        function startHermitCrabMinigame() {
            const minigameStyles = `
                .minigame-area {
                    display: flex;
                    flex-direction: column;
                    justify-content: flex-start;
                    align-items: center;
                    width: 100%;
                    height: 100%;
					max-height: 25em;
                    padding: 1em; 
                    box-sizing: border-box;
                }
                .minigame-area .all-slots-container {
                    position: relative;
                    display: grid;
                    grid-template-columns: repeat(3, 1fr);
                    gap: 0.5em; 
                    width: 100%;
                    max-width: 19em; 
					margin-top: 0.1em;
                }
                .minigame-area .slot-item-static {
                    width: 100%;
                    aspect-ratio: 1 / 1;
                    border: 3px solid #60a5fa; /* ê¸°ë³¸ í…Œë‘ë¦¬ ë‘ê»˜ 3pxë¡œ ìˆ˜ì • */
                    border-radius: 0.8em;
                    background: linear-gradient(145deg, #f8fafc 0%, #e2e8f0 100%);
                    transition: all 0.3s ease; /* í…Œë‘ë¦¬ ë³€ê²½ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
                }
                
                /* â˜… 1. ì„ íƒëœ ìŠ¬ë¡¯ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
                .minigame-area .slot-item-static.selected {
                    border-color: #f59e0b; /* ì£¼í™©ìƒ‰ í…Œë‘ë¦¬ */
                    box-shadow: 0 0 12px rgba(245, 158, 11, 0.6); /* ë¹›ë‚˜ëŠ” íš¨ê³¼ */
                }

                .minigame-area .moving-arrow {
                    position: absolute;
                    font-size: 2em; 
                    color: #f59e0b;
                    text-shadow: 0 1px 1px rgba(0,0,0,0.2);
                    animation-play-state: paused;
                    transform: translateX(-50%);
                    transition: opacity 0.3s ease;
                }
                #shellArrow { top: 33.3%; }
                #clawArrow { top: 66.6%; }
                #accArrow { top: 100%; }

                @keyframes moveArrowHorizontal {
                    0%   { left: 16.6%; }
                    100% { left: 83.3%; }
                }
                .minigame-area .controls-container {
                    width: 100%;
                    margin-top: 1.2em; 
                    text-align: center;
                }
            `;
            const oldStyle = document.getElementById('minigame-style-final-compact');
            if (oldStyle) oldStyle.remove();
            const styleSheet = document.createElement("style");
            styleSheet.id = 'minigame-style-final-compact';
            styleSheet.innerText = minigameStyles;
            document.head.appendChild(styleSheet);

            eventActionsEl.innerHTML = `
                <div class="minigame-area">
                    <div class="all-slots-container">
                        <div class="slot-item-static" id="shellItem1"><div class="slot-image" id="shellSlot1"></div></div>
                        <div class="slot-item-static" id="shellItem2"><div class="slot-image" id="shellSlot2"></div></div>
                        <div class="slot-item-static" id="shellItem3"><div class="slot-image" id="shellSlot3"></div></div>
                        <div class="slot-item-static" id="clawItem1"><div class="slot-image" id="clawSlot1"></div></div>
                        <div class="slot-item-static" id="clawItem2"><div class="slot-image" id="clawSlot2"></div></div>
                        <div class="slot-item-static" id="clawItem3"><div class="slot-image" id="clawSlot3"></div></div>
                        <div class="slot-item-static" id="accItem1"><div class="slot-image" id="accSlot1"></div></div>
                        <div class="slot-item-static" id="accItem2"><div class="slot-image" id="accSlot2"></div></div>
                        <div class="slot-item-static" id="accItem3"><div class="slot-image" id="accSlot3"></div></div>
                        
                        <div class="moving-arrow" id="shellArrow">ğŸ”º</div>
                        <div class="moving-arrow" id="clawArrow" style="opacity: 0;">ğŸ”º</div>
                        <div class="moving-arrow" id="accArrow" style="opacity: 0;">ğŸ”º</div>
                    </div>
                    <div class="controls-container">
                        <button class="stop-btn" id="stopBtn">STOP</button>
                    </div>
                </div>
            `;

            const shellOptions = ['images/anemone_event_shell_1.png', 'images/anemone_event_shell_2.png', 'images/anemone_event_shell_3.png'];
            const clawOptions = ['images/anemone_event_claw_1.png', 'images/anemone_event_claw_2.png', 'images/anemone_event_claw_1.png'];
            const accessoryOptions = ['images/anemone_event_acc_1.png', 'images/anemone_event_acc_2.png', 'images/anemone_event_acc_3.png'];

            shellOptions.forEach((img, i) => document.getElementById(`shellSlot${i + 1}`).style.backgroundImage = `url('${img}')`);
            clawOptions.forEach((img, i) => document.getElementById(`clawSlot${i + 1}`).style.backgroundImage = `url('${img}')`);
            accessoryOptions.forEach((img, i) => document.getElementById(`accSlot${i + 1}`).style.backgroundImage = `url('${img}')`);
            
            // ê° ìŠ¬ë¡¯ ì•„ì´í…œ(í…Œë‘ë¦¬ë¥¼ í¬í•¨í•œ div)ì„ ë°°ì—´ë¡œ ê´€ë¦¬
            const shellItems = [document.getElementById('shellItem1'), document.getElementById('shellItem2'), document.getElementById('shellItem3')];
            const clawItems = [document.getElementById('clawItem1'), document.getElementById('clawItem2'), document.getElementById('clawItem3')];
            const accItems = [document.getElementById('accItem1'), document.getElementById('accItem2'), document.getElementById('accItem3')];

            const arrows = { shell: document.getElementById('shellArrow'), claw: document.getElementById('clawArrow'), acc: document.getElementById('accArrow') };
            const stopBtn = document.getElementById('stopBtn');
            let selectedIndexes = { shell: 1, claw: 1, acc: 1 };
            let currentStage = 'shell';

            arrows.shell.style.animation = 'moveArrowHorizontal 1.2s ease-in-out infinite alternate';
            arrows.claw.style.animation = 'moveArrowHorizontal 1.0s ease-in-out infinite alternate';
            arrows.acc.style.animation = 'moveArrowHorizontal 0.8s ease-in-out infinite alternate';
            arrows.shell.style.animationPlayState = 'running';

            stopBtn.addEventListener('click', () => {
                if (currentStage === 'shell') {
                    arrows.shell.style.animationPlayState = 'paused';
                    const selectedIndex = getSelectedIndex(arrows.shell, shellItems);
                    selectedIndexes.shell = selectedIndex + 1;
                    
                    // â˜… 2. ì„ íƒëœ ìŠ¬ë¡¯ì— 'selected' í´ë˜ìŠ¤ ì¶”ê°€
                    shellItems[selectedIndex].classList.add('selected');
                    
                    currentStage = 'claw';
                    arrows.shell.style.opacity = 0;
                    arrows.claw.style.opacity = 1;
                    arrows.claw.style.animationPlayState = 'running';
                } else if (currentStage === 'claw') {
                    arrows.claw.style.animationPlayState = 'paused';
                    const selectedIndex = getSelectedIndex(arrows.claw, clawItems);
                    selectedIndexes.claw = selectedIndex + 1;
                    
                    // â˜… 2. ì„ íƒëœ ìŠ¬ë¡¯ì— 'selected' í´ë˜ìŠ¤ ì¶”ê°€
                    clawItems[selectedIndex].classList.add('selected');
                    
                    currentStage = 'acc';
                    arrows.claw.style.opacity = 0;
                    arrows.acc.style.opacity = 1;
                    arrows.acc.style.animationPlayState = 'running';
                } else if (currentStage === 'acc') {
                    arrows.acc.style.animationPlayState = 'paused';
                    const selectedIndex = getSelectedIndex(arrows.acc, accItems);
                    selectedIndexes.acc = selectedIndex + 1;
                    
                    // â˜… 2. ì„ íƒëœ ìŠ¬ë¡¯ì— 'selected' í´ë˜ìŠ¤ ì¶”ê°€
                    accItems[selectedIndex].classList.add('selected');
                    
                    stopBtn.disabled = true;
                    stopBtn.textContent = 'ì™„ë£Œ!';
                    arrows.acc.style.opacity = 0;
                    setTimeout(() => {
                        document.getElementById('minigame-style-final-compact').remove();
                        endHermitCrabMinigame(selectedIndexes.shell, selectedIndexes.claw, selectedIndexes.acc);
                    }, 1000);
                }
            });

            function getSelectedIndex(arrowElement, slotElements) {
                const arrowCenterX = arrowElement.getBoundingClientRect().left + (arrowElement.offsetWidth / 2);
                let closestIndex = 0;
                let minDistance = Infinity;
                for (let i = 0; i < slotElements.length; i++) {
                    const slotRect = slotElements[i].getBoundingClientRect();
                    const slotCenterX = slotRect.left + (slotRect.width / 2);
                    const distance = Math.abs(arrowCenterX - slotCenterX);
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestIndex = i;
                    }
                }
                return closestIndex;
            }
        }
		
        // ì†Œë¼ê²Œ ë¯¸ë‹ˆê²Œì„ ì¢…ë£Œ
		function endHermitCrabMinigame(shell, claw, accessory) {
		const minigameArea = document.querySelector('.minigame-area');
if (minigameArea) {
    minigameArea.style.display = 'none';
}

    const resultImage = `images/anemone_event_${shell}${claw}${accessory}.png`;
    
    // ê²°ê³¼ ì´ë¯¸ì§€ í‘œì‹œ
	console.log('í•„ìš”í•œ ì´ë¯¸ì§€:', resultImage);
    const resultImageEl = document.createElement('div');
    resultImageEl.className = 'result-image';
    resultImageEl.style.backgroundImage = `url('${resultImage}')`;
    document.body.appendChild(resultImageEl);
    
    playPositiveSound();
	const existingResults = document.querySelectorAll('.result-animation, .result-image');
	existingResults.forEach(el => {
		if (el !== resultImageEl) {
			el.remove();
		}
	});
    
    setTimeout(() => {
        resultImageEl.remove();
        
        const successTexts = [
            "ë‚˜ì˜ ì§ê¿ ì†Œë¼ê²Œë¥¼ ë§Œë‚¬ë‹¤!",
            "[íš¨ê³¼] ë§ë¯¸ì˜ ê°œì²´ìˆ˜ 30% ì¦ê°€"
        ];
        
        gameState.population *= 1.3;
        gameState.hermitCrabPartner = true;
        gameState.historyEvents.push(`${gameState.currentYear}ë…„ì°¨: ì†Œë¼ê²Œì™€ì˜ ê³µìƒìœ¼ë¡œ ë§ë¯¸ì˜ ê°œì²´ìˆ˜ 30% ì¦ê°€`);
        showEventResults(successTexts, true);
    }, 7000);
}

        // 4ë…„ì°¨ í°ë™ê°€ë¦¬ ê³µìƒ ì´ë²¤íŠ¸
        function showClownfishEvent() {
            choiceEventImageEl.style.backgroundImage = "url('images/anemone_event_clownfish.png')";
            
            typeText(choiceEventTextEl, "ë‹ˆëª¨ë¥¼ ë‹®ì€ í°ë™ê°€ë¦¬ê°€ ìš°ë¦¬ ë§ë¯¸ì˜ì„ ì°¾ì•„ì™”ë‹¤. ìì‹ ì´ ë¨¹ì´ë¥¼ ìœ ì¸í•´ì˜¬ í…Œë‹ˆ, ë¬´ì„œìš´ ì• ë“¤ë¡œë¶€í„° ìì‹ ì„ ìˆ¨ê²¨ë‹¬ë¼ëŠ” ì œì•ˆì„ í•´ì™”ë‹¤.", () => {
                choiceButtonsEl.classList.add('show');
            });
            
            document.getElementById('choice1Btn').textContent = "ì œì•ˆì„ ìŠ¹ë‚™í•œë‹¤";
            document.getElementById('choice2Btn').textContent = "ì œì•ˆì„ ê±°ì ˆí•œë‹¤";
            
            document.getElementById('choice1Btn').onclick = () => chooseClownfishOption(1);
            document.getElementById('choice2Btn').onclick = () => chooseClownfishOption(2);
            
            choiceEventModalEl.style.display = 'flex';
        }

        function chooseClownfishOption(choice) {
            choiceEventModalEl.style.display = 'none';
			
  eventActionsEl.innerHTML = '';
  eventTextEl.textContent = '';
            eventModalEl.style.display = 'flex';

            if (choice === 1) {
                // ìŠ¹ë‚™
                playPositiveSound();
                const successTexts = [
                    "í°ë™ê°€ë¦¬ì™€ì˜ ê³µìƒìœ¼ë¡œ, ë§ë¯¸ì˜ì€ í¸í•˜ê²Œ ë¨¹ì´ë¥¼ ë¨¹ê³ , í°ë™ê°€ë¦¬ëŠ” í¸í•˜ê²Œ í¬ì‹ìë¥¼ í”¼í•  ìˆ˜ ìˆì—ˆë‹¤!",
                    "[íš¨ê³¼] ë§ë¯¸ì˜ ê°œì²´ìˆ˜ 20% ì¦ê°€"
                ];
                
                gameState.population *= 1.2;
                gameState.clownfishPartner = true;
                gameState.historyEvents.push(`${gameState.currentYear}ë…„ì°¨: í°ë™ê°€ë¦¬ì™€ ê³µìƒ ê´€ê³„ë¥¼ ë§ºìœ¼ë©°, ë§ë¯¸ì˜ ê°œì²´ìˆ˜ 20% ì¦ê°€`);
                showEventResults(successTexts, true);
            } else {
                // ê±°ì ˆ
                playNegativeSound();
                const failTexts = [
                    "...ìŠ¹ë‚™í•  ê±¸ ê·¸ë¬ë‚˜ ë³´ë‹¤. ë– ë‹¤ë‹ˆë‹¤ê°€ ì„¼ìŠ¤ ìˆê²Œ ë§ë¯¸ì˜ í’ˆìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ë¨¹ì´ê°€ ë³„ë¡œ ì—†ë‹¤.",
                    "[íš¨ê³¼] ë§ë¯¸ì˜ ê°œì²´ìˆ˜ 10% ê°ì†Œ"
                ];
                
                gameState.population *= 0.9;
                gameState.historyEvents.push(`${gameState.currentYear}ë…„ì°¨: í°ë™ê°€ë¦¬ì™€ì˜ ê³µìƒì´ ë¶ˆë°œë˜ì–´, ë§ë¯¸ì˜ ê°œì²´ìˆ˜ 10% ê°ì†Œ`);
                showEventResults(failTexts, false);
            }
        }

        // 6ë…„ì°¨ ì†Œë¼ê²Œ ë°°ì‹  ì´ë²¤íŠ¸
        function showHermitCrabBetrayalEvent() {
            const eventSteps = [
                "ìš”ì¦˜ ë¨¹ì´ êµ¬í•˜ê¸°ê°€ ì–´ë ¤ì›Œì§€ë©´ì„œ ì†Œë¼ê²Œì™€ì˜ ì‚¬ì´ê°€ ì¡°ê¸ˆ ë°ë©´ë°ë©´í•´ì§„ ê²ƒ ê°™ë‹¤.",
                "ë¹„ìƒë¹„ìƒ!! ì†Œë¼ê²Œë“¤ì´ ëŒë³€í•˜ì—¬ ìš°ë¦¬ ë§ë¯¸ì˜ì„ ì¡ì•„ë¨¹ê¸° ì‹œì‘í–ˆë‹¤. ìœ¼ì•…, ê³µìƒ ê´€ê³„ëŠ” ë¬´ë„ˆì¡Œì–´.",
                "[íš¨ê³¼] ì†Œë¼ê²Œì˜ ì¡°ê±´ë¶€ ìƒë¦¬ê³µìƒìœ¼ë¡œ ê¸‰ê²©í•œ íƒœì„¸ ì „í™˜. ë§ë¯¸ì˜ ê°œì²´ìˆ˜ 30% ê°ì†Œ"
            ];
            
            let currentStep = 0;
            
            function showEventStep() {
                if (currentStep < eventSteps.length) {
                    eventTextEl.className = 'event-text negative';
                    typeText(eventTextEl, eventSteps[currentStep], () => {
                        currentStep++;
                        if (currentStep < eventSteps.length) {
                            eventActionsEl.innerHTML = `<button class="event-next-btn" onclick="showEventStep()">â–¼</button>`;
                        } else {
                            eventActionsEl.innerHTML = `<button class="event-next-btn" onclick="closeHermitCrabBetrayalEvent()">ì™„ë£Œ</button>`;
                        }
                    });
                }
            }
            
            eventActionsEl.innerHTML = '';
            eventModalEl.style.display = 'flex';
            playNegativeSound();
            showEventStep();
            
            window.showEventStep = showEventStep;
            window.closeHermitCrabBetrayalEvent = () => {
                eventModalEl.style.display = 'none';
                
                // ë§ë¯¸ì˜ ê°œì²´ìˆ˜ 30% ê°ì†Œ
                gameState.population *= 0.7;
                gameState.hermitCrabPartner = false;
                gameState.historyEvents.push(`${gameState.currentYear}ë…„ì°¨: ê³µìƒ ê´€ê³„ì˜€ë˜ ì†Œë¼ê²Œì™€ì˜ ê³µìƒ ê´€ê³„ê°€ ê¹¨ì§€ë©°, ì†Œë¼ê²Œì—ê²Œ í¬ì‹ ë‹¹í•´ ê°œì²´ìˆ˜ 30% ê°ì†Œ`);
                
                simulateEcosystem();
                
                // íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
                gameState.populationHistory.push(gameState.population);
                gameState.foodHistory.push(gameState.food);
                
                if (gameState.population <= 5) {
                    showExtinctionEnding();
                } else if (gameState.currentYear >= 10) {
                    showSuccessEnding();
                } else {
                    showYearlyDialogue();
                }
                
                updateDisplay();
            };
        }

        // 7ë…„ì°¨ ì—˜ë‹ˆë‡¨ ì´ë²¤íŠ¸
        function showElNinoEvent() {
            const eventSteps = [
                "ì˜¬í•´ ì—˜ë‹ˆë‡¨ë¡œ ì¸í•´ í‰ê·  ìˆ˜ì˜¨ì´ ì˜ˆìƒë³´ë‹¤ 3â„ƒ ë” ìƒìŠ¹í•˜ì˜€ë‹¤.",
                "ê°‘ì‘ìŠ¤ëŸ° ìˆ˜ì˜¨ ë³€í™”ë¡œ, í°ë™ê°€ë¦¬ì˜ ì‚¬ë§ë¥ ê³¼ ë²ˆì‹ë¥ ë„ ê°ì†Œí•˜ì—¬ ë§ë¯¸ì˜ìƒ ìµœëŒ€ ìœ„ê¸°ë¥¼ ë§ê²Œ ë˜ì—ˆë‹¤.",
                "[íš¨ê³¼] ë§ë¯¸ì˜ ê°œì²´ìˆ˜ 50% ê°ì†Œ"
            ];
            
            let currentStep = 0;
            
            function showEventStep() {
                if (currentStep < eventSteps.length) {
                    eventTextEl.className = 'event-text negative';
                    typeText(eventTextEl, eventSteps[currentStep], () => {
                        currentStep++;
                        if (currentStep < eventSteps.length) {
                            eventActionsEl.innerHTML = `<button class="event-next-btn" onclick="showEventStep()">â–¼</button>`;
                        } else {
                            eventActionsEl.innerHTML = `<button class="event-next-btn" onclick="closeElNinoEvent()">ì™„ë£Œ</button>`;
                        }
                    });
                }
            }
            
            eventActionsEl.innerHTML = '';
            eventModalEl.style.display = 'flex';
            playNegativeSound();
            showEventStep();
            
            window.showEventStep = showEventStep;
            window.closeElNinoEvent = () => {
                eventModalEl.style.display = 'none';
                
                // ì‹¤ì œ ìˆ˜ì˜¨ 3ë„ ìƒìŠ¹
                const originalTemp = gameState.temperature;
                gameState.temperature += 3;
                gameState.temperatureHistory[gameState.currentYear] = gameState.temperature; // ë³€ê²½ëœ ì˜¨ë„ë¡œ íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
                updateDisplay(); // ìˆ˜ì˜¨ í‘œì‹œ ì—…ë°ì´íŠ¸
                
                gameState.population *= 0.5; // 50% ê°ì†Œ
                gameState.historyEvents.push(`${gameState.currentYear}ë…„ì°¨: ì—˜ë‹ˆë‡¨ë¡œ ì¸í•œ ê°‘ì‘ìŠ¤ëŸ° ìˆ˜ì˜¨ ìƒìŠ¹ (${originalTemp}Â°C â†’ ${gameState.temperature}Â°C)ìœ¼ë¡œ, ë§ë¯¸ì˜ ê°œì²´ ìˆ˜ 50% ê°ì†Œ`);
                
                // ì˜¨ë„ ìŠ¤íŠ¸ë ˆìŠ¤ ì ìš© (ë³€ê²½ëœ ì˜¨ë„ ê¸°ì¤€)
                calculateTemperatureStress(gameState.temperature);
                
                simulateEcosystem();
                
                // íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
                gameState.populationHistory.push(gameState.population);
                gameState.foodHistory.push(gameState.food);
                
                if (gameState.population <= 5) {
                    showExtinctionEnding();
                } else if (gameState.currentYear >= 10) {
                    showSuccessEnding();
                } else {
                    // 7ë…„ì°¨ ì—˜ë‹ˆë‡¨ ì´ë²¤íŠ¸ í›„ ë‹¤ìŒ í•´ ì§„í–‰
                    showGameActions();
                }
                
                updateDisplay();
            };
        }

        // ì´ë²¤íŠ¸ ê²°ê³¼ í‘œì‹œ
        function showEventResults(texts, isPositive) {
            let currentTextIndex = 0;
            
            function showNextText() {
                if (currentTextIndex < texts.length) {
                    eventTextEl.className = isPositive ? 'event-text positive' : 'event-text negative';
                    typeText(eventTextEl, texts[currentTextIndex], () => {
                        currentTextIndex++;
                        if (currentTextIndex < texts.length) {
                            eventActionsEl.innerHTML = `<button class="event-next-btn" onclick="showNextText()">â–¼</button>`;
                        } else {
                            eventActionsEl.innerHTML = `<button class="event-next-btn" onclick="closeEvent()">ì™„ë£Œ</button>`;
                        }
                    });
                }
            }
            
            window.showNextText = showNextText;
            window.closeEvent = () => {
                eventModalEl.style.display = 'none';
                
                simulateEcosystem();
                
                // íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
                gameState.populationHistory.push(gameState.population);
                gameState.foodHistory.push(gameState.food);
                
                if (gameState.population <= 5) {
                    showExtinctionEnding();
                } else if (gameState.currentYear >= 10) {
                    showSuccessEnding();
                } else {
                    showYearlyDialogue();
                }
                
                updateDisplay();
            };
            
            showNextText();
        }

        // ê²Œì„ ê²°ê³¼ ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ
        function showResultAnimation(isSuccess, callback) {
            const animationEl = document.createElement('div');
            animationEl.className = `result-animation ${isSuccess ? 'success' : 'failure'}`;
            animationEl.textContent = isSuccess ? 'ğŸ‰ìƒì¡´ ì„±ê³µ!ğŸ‰' : 'â˜  ë§ë¯¸ì˜ ì ˆë©¸...â˜  ';
            
            document.querySelector('.game-container').appendChild(animationEl);
            
            setTimeout(() => {
                animationEl.remove();
                if (callback) callback();
            }, 2000);
        }

        // ì ˆë©¸ ì—”ë”©
        function showExtinctionEnding() {
            gameState.gameEnded = true;
            characterEl.style.backgroundImage = "url('images/anemone_dead.png')";
            
            playFailureSound();
            showResultAnimation(false, () => {
                typeText(dialogueTextEl, `ìš°ë¦¬ ë§ë¯¸ì˜ ê°œì²´êµ°ì€ ${gameState.currentYear}ë…„ì°¨ì— ì—­ì‚¬ ì†ìœ¼ë¡œ ì‚¬ë¼ì§€ê²Œ ë˜ì—ˆì–´... ã… ã…  `, () => {
                    dialogueActionsEl.innerHTML = `
                        <button class="action-btn secondary" onclick="restartGame()">ì¬ë„ì „</button>
                        <button class="action-btn danger" onclick="goToMain()">ë©”ì¸ í™”ë©´</button>
                        <button class="next-btn" id="showHistoryBtn" title="íˆìŠ¤í† ë¦¬">ğŸ“‹</button>
                    `;
                    document.getElementById('showHistoryBtn').addEventListener('click', showHistory);
                });
            });
        }

        // ì„±ê³µ ì—”ë”©
        function showSuccessEnding() {
            gameState.gameEnded = true;
            characterEl.style.backgroundImage = "url('images/anemone_wow.png')";
            
            playSuccessSound();
            showResultAnimation(true, () => {
                typeText(dialogueTextEl, "ê³ ë§ˆì›Œ! ë„¤ ë•ë¶„ì— ìš°ë¦¬ ë§ë¯¸ì˜ ê°œì²´êµ°ì€ 10ë…„ ë™ì•ˆ ì•ˆì •ì ì¸ ê°œì²´êµ°ì„ ìœ ì§€í•  ìˆ˜ ìˆì—ˆì–´!", () => {
                    dialogueActionsEl.innerHTML = `
                        <button class="action-btn" onclick="goToMain()">ë©”ì¸ í™”ë©´</button>
                        <button class="next-btn" id="showHistoryBtn" title="íˆìŠ¤í† ë¦¬">ğŸ“‹</button>
                    `;
                    document.getElementById('showHistoryBtn').addEventListener('click', showHistory);
                }, 'dialogue-text success');
            });
        }

        // ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            yearDisplayEl.textContent = `${gameState.currentYear}ë…„ì°¨`;
            populationDisplayEl.textContent = `ê°œì²´ìˆ˜: ${Math.floor(gameState.population)}ë§ˆë¦¬`;
            foodDisplayEl.textContent = `í”Œë‘í¬í†¤: ${Math.floor(gameState.food)}ë§ˆë¦¬`;
            tempDisplayEl.textContent = `ìˆ˜ì˜¨: ${gameState.temperature}Â°C`;
        }

        // ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
        function enableButtons() {
            graphBtnEl.disabled = false;
        }

        function disableButtons() {
            graphBtnEl.disabled = true;
        }

        // ë¡œë”© í‘œì‹œ
        function showLoading() {
            loadingOverlayEl.style.display = 'flex';
            typeText(document.getElementById('loadingText'), 'ë²ˆì‹ ì¤‘...');
        }

        function hideLoading() {
            loadingOverlayEl.style.display = 'none';
        }

        // ê·¸ë˜í”„ í‘œì‹œ
        function showGraph() {
            if (!gameState.dialogueComplete) return;

            graphModalEl.style.display = 'flex';
            
            setTimeout(() => {
                const canvas = document.getElementById('graphCanvas');
                const ctx = canvas.getContext('2d');
                
                const rect = canvas.getBoundingClientRect();
                const dpr = window.devicePixelRatio || 1;
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                ctx.scale(dpr, dpr);
                
                const width = rect.width;
                const height = rect.height;
                const padding = 80;
                const graphWidth = width - 2 * padding;
                const graphHeight = height - 2 * padding;
                
                // ë°°ê²½
                ctx.fillStyle = '#fafbfc';
                ctx.fillRect(0, 0, width, height);
                
                // ìµœëŒ€ê°’ ê³„ì‚°
                const maxPop = Math.max(...gameState.populationHistory);
                const maxFood = Math.max(...gameState.foodHistory);
                const maxYear = gameState.populationHistory.length - 1;
                
                // ê²©ìì„ 
                ctx.strokeStyle = '#e8ecf0';
                ctx.lineWidth = 1;
                
                for (let i = 0; i <= 8; i++) {
                    const y = padding + (i / 8) * graphHeight;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(width - padding, y);
                    ctx.stroke();
                }
                
                for (let i = 0; i <= maxYear; i++) {
                    const x = padding + (i / maxYear) * graphWidth;
                    ctx.beginPath();
                    ctx.moveTo(x, padding);
                    ctx.lineTo(x, height - padding);
                    ctx.stroke();
                }
                
                // ì¶•
                ctx.strokeStyle = '#2d3748';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, height - padding);
                ctx.moveTo(width - padding, padding);
                ctx.lineTo(width - padding, height - padding);
                ctx.moveTo(padding, height - padding);
                ctx.lineTo(width - padding, height - padding);
                ctx.stroke();
                
                // ë§ë¯¸ì˜ ê°œì²´ìˆ˜ ì„  (ë¶„í™ìƒ‰, ì™¼ìª½ ì¶• ê¸°ì¤€)
                if (gameState.populationHistory.length > 1) {
                    ctx.strokeStyle = '#ec4899';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    
                    for (let i = 0; i < gameState.populationHistory.length; i++) {
                        const x = padding + (i / maxYear) * graphWidth;
                        const y = height - padding - (gameState.populationHistory[i] / maxPop) * graphHeight;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.stroke();
                }
                
                // í”Œë‘í¬í†¤ ê°œì²´ìˆ˜ ì„  (ì²­ë¡ìƒ‰, ì˜¤ë¥¸ìª½ ì¶• ê¸°ì¤€)
                if (gameState.foodHistory.length > 1) {
                    ctx.strokeStyle = '#06b6d4';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    
                    for (let i = 0; i < gameState.foodHistory.length; i++) {
                        const x = padding + (i / maxYear) * graphWidth;
                        const y = height - padding - (gameState.foodHistory[i] / maxFood) * graphHeight;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.stroke();
                }
                
                // ë ˆì´ë¸”
                ctx.fillStyle = '#4a5568';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                
                // Xì¶• ë ˆì´ë¸”
                for (let i = 0; i <= maxYear; i++) {
                    const x = padding + (i / maxYear) * graphWidth;
                    ctx.fillText(`${i}ë…„`, x, height - padding + 20);
                }
                
                // ì™¼ìª½ Yì¶• ë ˆì´ë¸” (ë§ë¯¸ì˜)
                ctx.textAlign = 'right';
                ctx.fillStyle = '#ec4899';
                for (let i = 0; i <= 8; i++) {
                    const y = height - padding - (i / 8) * graphHeight;
                    const value = Math.round((i / 8) * maxPop);
                    ctx.fillText(`${value}`, padding - 10, y + 4);
                }
                
                // ì˜¤ë¥¸ìª½ Yì¶• ë ˆì´ë¸” (í”Œë‘í¬í†¤)
                ctx.textAlign = 'left';
                ctx.fillStyle = '#06b6d4';
                for (let i = 0; i <= 8; i++) {
                    const y = height - padding - (i / 8) * graphHeight;
                    const value = Math.round((i / 8) * maxFood);
                    ctx.fillText(`${value}`, width - padding + 10, y + 4);
                }
                
                // ë²”ë¡€
                ctx.fillStyle = '#ec4899';
                ctx.fillRect(width / 2 - 80, 30, 20, 3);
                ctx.fillStyle = '#4a5568';
                ctx.textAlign = 'left';
                ctx.fillText('ë§ë¯¸ì˜ ê°œì²´ìˆ˜', width / 2 - 55, 35);
                
                ctx.fillStyle = '#06b6d4';
                ctx.fillRect(width / 2 - 80, 50, 20, 3);
                ctx.fillStyle = '#4a5568';
                ctx.fillText('í”Œë‘í¬í†¤ ê°œì²´ìˆ˜', width / 2 - 55, 55);
            }, 100);
        }

        // íˆìŠ¤í† ë¦¬ í‘œì‹œ
        function showHistory() {
            if (!gameState.dialogueComplete) return;

            historyModalEl.style.display = 'flex';
            
            let historyText = '';
            for (let i = 0; i < gameState.populationHistory.length; i++) {
                historyText += `${i}ë…„ì°¨: ë§ë¯¸ì˜ ${Math.floor(gameState.populationHistory[i])}ë§ˆë¦¬`;
                if (gameState.foodHistory[i] !== undefined) {
                    historyText += `, í”Œë‘í¬í†¤ ${Math.floor(gameState.foodHistory[i])}ë§ˆë¦¬`;
                }
                if (gameState.temperatureHistory[i] !== undefined) {
                    historyText += `, ìˆ˜ì˜¨ ${gameState.temperatureHistory[i]}Â°C`;
                }
                historyText += '\n';
            }
            
            // ì´ë²¤íŠ¸ íˆìŠ¤í† ë¦¬ ì¶”ê°€
            if (gameState.historyEvents.length > 0) {
                historyText += '\n=== ì£¼ìš” ì‚¬ê±´ ===\n';
                gameState.historyEvents.forEach(event => {
                    historyText += event + '\n';
                });
            }
            
            historyContentEl.textContent = historyText;
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function hideGraph() {
            graphModalEl.style.display = 'none';
        }

        function hideHistory() {
            historyModalEl.style.display = 'none';
        }

        // ê²Œì„ ì¬ì‹œì‘/ì¢…ë£Œ
        function restartGame() {
            location.reload();
        }

        function goToMain() {
            window.location.href = 'intro.html';
        }

        function goBack() {
            window.location.href = 'game.html';
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            updateDisplay();
            disableButtons();
            
            // ì²« ë²ˆì§¸ ëŒ€ì‚¬ ì‹œì‘í•˜ê³  dialogueStep ì¦ê°€
            typeText(dialogueTextEl, initialDialogues[0]);
            gameState.dialogueStep = 1;
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            backBtnEl.addEventListener('click', goBack);
            graphBtnEl.addEventListener('click', showGraph);
            document.getElementById('closeGraphBtn').addEventListener('click', hideGraph);
            document.getElementById('closeHistoryBtn').addEventListener('click', hideHistory);
            document.getElementById('nextBtn').addEventListener('click', nextDialogue);
        });
    </script>
</body>
</html>