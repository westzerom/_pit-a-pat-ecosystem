<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†Œë‚˜ë¬´ Easy - ë‘ê·¼ë‘ê·¼ ê°œì²´êµ° í‚¤ìš°ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(45deg, #2d5016 0%, #4a7c59 50%, #6b9080 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: repeating-linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.03) 0px,
                rgba(255, 255, 255, 0.03) 2px,
                transparent 2px,
                transparent 12px
            );
            pointer-events: none;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .game-container {
            width: 100vw;
            height: 56.25vw;
            max-width: 1280px;
            max-height: 720px;
            position: relative;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 2em;
            box-shadow: 
                0 0 0 3px rgba(255, 255, 255, 0.2),
                0 1.5em 4em rgba(0, 0, 0, 0.2),
                inset 0 0.06em 0 rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(0.6em);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            font-size: calc(1vw + 0.5vh);
        }

        @media (min-width: 1280px) {
            .game-container {
                font-size: 16px;
            }
        }

        @media screen and (min-aspect-ratio: 16/9) {
            .game-container {
                width: 177.78vh;
                height: 100vh;
            }
        }

        .status-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 1em 2em;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(0.3em);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 2.5em;
            height: 2.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.3s ease;
            box-shadow: 0 0.25em 0.75em rgba(0, 0, 0, 0.1);
        }

        .back-btn:hover {
            background: white;
            transform: translateY(-0.06em);
            box-shadow: 0 0.37em 1em rgba(0, 0, 0, 0.15);
        }

        .status-info {
            display: flex;
            gap: 1em;
            align-items: center;
        }

        .status-display {
            background: rgba(255, 255, 255, 0.9);
            padding: 0.5em 1em;
            border-radius: 1em;
            font-weight: 700;
            color: #2D3748;
            font-size: 0.9em;
            box-shadow: 0 0.25em 0.75em rgba(0, 0, 0, 0.1);
        }

        .graph-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            border: none;
            border-radius: 0.8em;
            padding: 0.5em 1em;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8em;
            box-shadow: 0 0.25em 0.75em rgba(72, 187, 120, 0.3);
        }

        .graph-btn:hover:not(:disabled) {
            transform: translateY(-0.06em);
            box-shadow: 0 0.37em 1em rgba(72, 187, 120, 0.4);
        }

        .graph-btn:disabled {
            background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .character-area {
            position: absolute;
            top: 4em;
            bottom: 4em;
            left: 0;
            right: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1em 2em;
			
			/* ë°°ê²½ ì´ë¯¸ì§€ ì¶”ê°€ */
			background-image: url('images/tree_background.png');
			background-size: cover;
			background-position: center;
			background-repeat: no-repeat;
        }

        .character {
            width: 18em;
            height: 18em;
            background-image: url('images/tree_main.png');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            animation: sway 3s ease-in-out infinite;
            filter: drop-shadow(0 0.4em 1em rgba(0, 0, 0, 0.15));
            transition: background-image 0.5s ease;
        }

        @keyframes sway {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-1deg); }
            75% { transform: rotate(1deg); }
        }

        .dialogue-container {
            position: absolute;
            bottom: 2em;
            left: 0;
            right: 0;
            background: white;
            border-radius: 1.5em 1.5em 1.5em 1.5em;
            padding: 1.5em;
            box-shadow: 
                0 -0.4em 1.2em rgba(0, 0, 0, 0.1),
                inset 0 0.06em 0 rgba(255, 255, 255, 0.7);
        }

        .dialogue-text {
            font-size: 1em;
            line-height: 1.5;
            color: #2D3748;
            margin-bottom: 1em;
            min-height: 3.5em;
            display: flex;
            align-items: center;
            font-weight: 500;
        }

        .dialogue-text.success {
            color: #22c55e;
            font-weight: 600;
        }

        .dialogue-actions {
            display: flex;
            gap: 0.8em;
            justify-content: flex-end;
            align-items: center;
        }

        .next-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50%;
            width: 2.5em;
            height: 2.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 0.3em 0.8em rgba(102, 126, 234, 0.3),
                inset 0 0.06em 0 rgba(255, 255, 255, 0.2);
        }

        .next-btn:hover:not(:disabled) {
            transform: translateY(-0.12em) scale(1.05);
            box-shadow: 
                0 0.75em 1.5em rgba(102, 126, 234, 0.4),
                inset 0 0.06em 0 rgba(255, 255, 255, 0.3);
        }
        
        .next-btn:disabled {
            cursor: not-allowed;
            background: #ccc;
        }

        .action-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            border: none;
            border-radius: 1.2em;
            padding: 0.8em 1.5em;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            box-shadow: 0 0.37em 0.9em rgba(72, 187, 120, 0.3);
        }

        .action-btn:hover:not(:disabled) {
            transform: translateY(-0.06em);
            box-shadow: 0 0.5em 1.2em rgba(72, 187, 120, 0.4);
        }

        .action-btn:disabled {
            background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);
            box-shadow: 0 0.37em 0.9em rgba(159, 122, 234, 0.3);
        }

        .action-btn.secondary:hover:not(:disabled) {
            box-shadow: 0 0.5em 1.2em rgba(159, 122, 234, 0.4);
        }

        .action-btn.danger {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            box-shadow: 0 0.37em 0.9em rgba(229, 62, 62, 0.3);
        }

        .action-btn.danger:hover:not(:disabled) {
            box-shadow: 0 0.5em 1.2em rgba(229, 62, 62, 0.4);
        }

        /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
        .input-container {
            display: flex;
            align-items: center;
            gap: 0.5em;
            margin: 1em 0;
            flex-wrap: wrap;
        }

        .input-field {
            padding: 0.5em;
            border: 2px solid #cbd5e0;
            border-radius: 0.5em;
            font-size: 1em;
            width: 6em;
            text-align: center;
        }

        .confirm-btn {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            border: none;
            border-radius: 0.8em;
            padding: 0.5em 1em;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .confirm-btn:hover {
            transform: translateY(-0.06em);
        }

        /* ì´ë²¤íŠ¸ ëª¨ë‹¬ */
        .event-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 2em;
        }

        .event-content {
            background: white;
            padding: 2em;
            border-radius: 1.5em;
            box-shadow: 0 1.2em 2.4em rgba(0, 0, 0, 0.3);
            position: relative;
            width: 90%;
            max-width: 35em;
            max-height: 80%;
        }

        .event-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #2D3748;
            margin-bottom: 1.5em;
            min-height: 4em;
        }

        .event-text.positive {
            color: #2563eb;
        }

        .event-text.negative {
            color: #dc2626;
        }

        .event-next-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: none;
            border-radius: 50%;
            width: 3em;
            height: 3em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
            transition: all 0.3s ease;
            margin: 0 auto;
        }

        .event-next-btn:hover {
            transform: scale(1.1);
        }

        .choice-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 1em;
            padding: 1em 1.5em;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            margin: 0.5em;
            width: calc(100% - 1em);
            text-align: left;
        }

        .choice-btn:hover {
            transform: translateY(-0.06em);
            box-shadow: 0 0.5em 1.2em rgba(102, 126, 234, 0.4);
        }

        /* ê·¸ë˜í”„ ëª¨ë‹¬ */
        .graph-modal, .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 2em;
        }

        .history-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 2em;
        }

        .graph-content, .loading-content {
            background: white;
            padding: 2em;
            border-radius: 1.5em;
            box-shadow: 0 1.2em 2.4em rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .graph-content { 
            width: 90%; 
            max-width: 35em; 
            max-height: 80%;
        }
        
        .loading-content { 
            text-align: center; 
            font-size: 2em; 
            font-weight: 700; 
            color: #2D3748; 
            padding: 2em;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1.5em;
            box-shadow: 0 1.2em 2.4em rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
        }

        .graph-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5em;
        }

        .graph-title { 
            font-size: 1.3em; 
            font-weight: 700; 
            color: #2D3748; 
        }

        .close-btn {
            background: #e53e3e; 
            border: none; 
            border-radius: 50%; 
            width: 2em; 
            height: 2em;
            color: white; 
            cursor: pointer; 
            font-size: 1.2em; 
            transition: all 0.3s ease;
        }
        
        .close-btn:hover { 
            background: #c53030; 
            transform: scale(1.1); 
        }

        .history-content {
            max-height: 300px; 
            overflow-y: auto; 
            padding: 1em; 
            background: #f7fafc; 
            border-radius: 0.5em; 
            font-family: monospace; 
            line-height: 1.5;
            white-space: pre-line;
        }

        .typing-cursor { 
            animation: blink 1s infinite; 
        }
        
        @keyframes blink { 
            0%, 50% { opacity: 1; } 
            51%, 100% { opacity: 0; } 
        }

        /* ê²Œì„ ê²°ê³¼ ì• ë‹ˆë©”ì´ì…˜ */
        .result-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            font-weight: 900;
            text-align: center;
            z-index: 100;
            animation: resultPop 2s ease-out;
            pointer-events: none;
        }

        .result-animation.success {
            color: #22c55e;
            text-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
        }

        .result-animation.failure {
            color: #ef4444;
            text-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }

        @keyframes resultPop {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2) rotate(0deg);
                opacity: 1;
            }
            80% {
                transform: translate(-50%, -50%) scale(1.1) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="status-bar">
            <button class="back-btn" id="backBtn">â†</button>
            <div class="status-info" id="statusInfo">
                <div class="status-display" id="yearDisplay">0ë…„ì°¨</div>
                <div class="status-display" id="populationDisplay">ê°œì²´ìˆ˜: 50ê·¸ë£¨</div>
                <div class="status-display" id="sunlightDisplay">í–‡ë¹›: -</div>
                <div class="status-display" id="oakDisplay">ì°¸ë‚˜ë¬´: -ê·¸ë£¨</div>
                <button class="graph-btn" id="graphBtn" disabled>ê°œì²´ìˆ˜ ê·¸ë˜í”„</button>
            </div>
        </div>

        <div class="character-area" id="characterArea">
            <div class="character" id="character"></div>
        </div>

        <div class="dialogue-container" id="dialogueContainer">
            <div class="dialogue-text" id="dialogueText"></div>
            <div class="dialogue-actions" id="dialogueActions">
                <button class="next-btn" id="nextBtn">ğŸ”½</button>
            </div>
        </div>

        <!-- ì´ë²¤íŠ¸ ëª¨ë‹¬ -->
        <div class="event-modal" id="eventModal">
            <div class="event-content">
                <div class="event-text" id="eventText"></div>
                <div id="eventActions">
                    <button class="event-next-btn" id="eventNextBtn">â–¼</button>
                </div>
            </div>
        </div>

        <!-- ê·¸ë˜í”„ ëª¨ë‹¬ -->
        <div class="graph-modal" id="graphModal">
             <div class="graph-content">
                <div class="graph-header">
                    <div class="graph-title">ê°œì²´ìˆ˜ ë³€í™” ê·¸ë˜í”„</div>
                    <button class="close-btn" id="closeGraphBtn">Ã—</button>
                </div>
                <canvas class="graph-canvas" id="graphCanvas" style="width: 100%; height: 20em; border: 1px solid #e2e8f0; border-radius: 0.5em;"></canvas>
            </div>
        </div>

        <!-- íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ -->
        <div class="history-modal" id="historyModal">
             <div class="graph-content">
                <div class="graph-header">
                    <div class="graph-title">íˆìŠ¤í† ë¦¬</div>
                    <button class="close-btn" id="closeHistoryBtn">Ã—</button>
                </div>
                <div class="history-content" id="historyContent"></div>
            </div>
        </div>

        <!-- ë¡œë”© ëª¨ë‹¬ -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content" id="loadingText">ì‹œê°„ì´ íë¥´ê³  ìˆì–´...</div>
        </div>
    </div>

    <script>
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            currentYear: 0,
            population: 50,
            sunlight: 0,
            oak: 0,
            populationHistory: [50],
            sunlightHistory: [],
            oakHistory: [],
            historyEvents: [],
            dialogueStep: 0,
            isTyping: false,
            gameEnded: false,
            dialogueComplete: false,
            pendingBonus: null // 2ë…„ì°¨ ì„ íƒì§€ 2 íš¨ê³¼ë¥¼ ìœ„í•œ ë³€ìˆ˜
        };

        // DOM ìš”ì†Œë“¤
        const dialogueTextEl = document.getElementById('dialogueText');
        const dialogueActionsEl = document.getElementById('dialogueActions');
        const characterEl = document.getElementById('character');
        const yearDisplayEl = document.getElementById('yearDisplay');
        const populationDisplayEl = document.getElementById('populationDisplay');
        const sunlightDisplayEl = document.getElementById('sunlightDisplay');
        const oakDisplayEl = document.getElementById('oakDisplay');
        const graphBtnEl = document.getElementById('graphBtn');
        const backBtnEl = document.getElementById('backBtn');
        const eventModalEl = document.getElementById('eventModal');
        const eventTextEl = document.getElementById('eventText');
        const eventActionsEl = document.getElementById('eventActions');
        const graphModalEl = document.getElementById('graphModal');
        const historyModalEl = document.getElementById('historyModal');
        const loadingOverlayEl = document.getElementById('loadingOverlay');
        const historyContentEl = document.getElementById('historyContent');

        // ì´ˆê¸° ëŒ€ì‚¬
        const initialDialogues = [
            "ì†”ì†”ì†”. ë‚˜ëŠ” ì†Œë‚˜ë¬´ì•¼.",
            "ë‹¤ë¥¸ ì‹ë¬¼ë“¤ì²˜ëŸ¼, ë‚˜ëŠ” í–‡ë¹›ì„ í¡ìˆ˜í•´ ê´‘í•©ì„±ì„ í†µí•´ í•„ìš”í•œ ì–‘ë¶„ì„ í•©ì„±í•´.",
            "ë‚˜ëŠ” ê´‘í¬í™”ì ê³¼ ë³´ìƒì ì´ ë†’ì€ í¸ì´ë¼, ë¹›ì´ ì„¼ í™˜ê²½ì¼ìˆ˜ë¡ ìœ ë¦¬í•´.",
            "ìš”ì¦˜ ìš°ë¦¬ ë™ë„¤ì— ì°¸ë‚˜ë¬´ë¼ëŠ” ì‹ ì°¸ ë‚˜ë¬´ë“¤ì´ ìë¼ê³  ìˆëŠ”ë°â€¦ê±”ë„¤ëŠ” ê´‘í¬í™”ì ê³¼ ë³´ìƒì ì´ ë‚®ì•„ì„œ ê´œì°®ìœ¼ë ¤ë‚˜ ëª°ë¼~",
            "ì•„ë¬´íŠ¼, ìš°ë¦¬ ê°œì²´êµ°ì€ ê³„ì† ì„±ì¥í•´ë‚˜ê°ˆ ìˆ˜ ìˆì„ê¹Œ?",
            "ìš°ë¦¬ ì†Œë‚˜ë¬´ ê°œì²´êµ°ì€ ì§€ê¸ˆ 50ê·¸ë£¨ê°€ ìˆì–´.",
            "ì§€ê¸ˆì€ ë‚´ê°€ ìš°ë¦¬ ì§€ì—­ì—ì„œ ê°€ì¥ í‚¤ê°€ ì»¤ì„œ, í–‡ë¹›ì„ ë§ì´ ë°›ì„ ìˆ˜ ìˆì–´.",
            "í–‡ë¹›ì„ ë§ì´ ë°›ëŠ” ê²Œ 500, ì ê²Œ ë°›ëŠ” ê²Œ 10ì´ë¼ ì¹˜ë©´ ì§€ê¸ˆ ë‚˜ëŠ” í–‡ë¹›ì„ ì–´ëŠ ì •ë„ ë°›ê³  ìˆë‹¤ê³  í• ë˜?"
        ];

        // íš¨ê³¼ìŒ í•¨ìˆ˜
        const audioFiles = {
            positive: new Audio('audio/positive.mp3'),
            negative: new Audio('audio/negative.mp3'),
            success: new Audio('audio/success.mp3'),
            failure: new Audio('audio/failure.mp3')
        };

        // ëª¨ë“  ì˜¤ë””ì˜¤ íŒŒì¼ ë¯¸ë¦¬ ë¡œë“œ
        Object.values(audioFiles).forEach(audio => {
            audio.preload = 'auto';
        });

        // íš¨ê³¼ìŒ ì¬ìƒ í•¨ìˆ˜ë“¤
        function playPositiveSound() {
            audioFiles.positive.currentTime = 0;
            audioFiles.positive.play().catch(e => console.log('ê¸ì • íš¨ê³¼ìŒ ì¬ìƒ ì˜¤ë¥˜:', e));
        }

        function playNegativeSound() {
            audioFiles.negative.currentTime = 0;
            audioFiles.negative.play().catch(e => console.log('ë¶€ì • íš¨ê³¼ìŒ ì¬ìƒ ì˜¤ë¥˜:', e));
        }

        function playSuccessSound() {
            audioFiles.success.currentTime = 0;
            audioFiles.success.play().catch(e => console.log('ì„±ê³µ íš¨ê³¼ìŒ ì¬ìƒ ì˜¤ë¥˜:', e));
        }

        function playFailureSound() {
            audioFiles.failure.currentTime = 0;
            audioFiles.failure.play().catch(e => console.log('ì‹¤íŒ¨ íš¨ê³¼ìŒ ì¬ìƒ ì˜¤ë¥˜:', e));
        }

        // íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜
        function typeText(element, text, callback, className = '') {
            if (gameState.isTyping) return;
            
            gameState.isTyping = true;
            if (className) {
                element.className = className;
            }
            element.innerHTML = '';
            let i = 0;
            const cursor = '<span class="typing-cursor">|</span>';
            
            function type() {
                if (i < text.length) {
                    element.innerHTML = text.substring(0, i + 1) + cursor;
                    i++;
                    setTimeout(type, 50);
                } else {
                    element.innerHTML = text;
                    gameState.isTyping = false;
                    if (callback) callback();
                }
            }
            type();
        }

        // ëŒ€ì‚¬ ì§„í–‰
        function nextDialogue() {
            if (gameState.isTyping) return;
            
            if (gameState.dialogueStep < initialDialogues.length) {
                typeText(dialogueTextEl, initialDialogues[gameState.dialogueStep], () => {
                    // í–‡ë¹› ì„¤ì • ëŒ€í™” í›„
                    if (gameState.dialogueStep === initialDialogues.length) {
                        showSunlightInput();
                    }
                });
                gameState.dialogueStep++;
            } else if (gameState.dialogueStep === initialDialogues.length) {
                // í–‡ë¹› ì„¤ì • í›„
                const afterSunlightText = `ê·¸ëŸ¬ë©´ ì§€ê¸ˆ í–‡ë¹›ì€ ${gameState.sunlight} ì •ë„êµ¬ë‚˜!`;
                typeText(dialogueTextEl, afterSunlightText, () => {
                    gameState.dialogueStep++;
                });
            } else if (gameState.dialogueStep === initialDialogues.length + 1) {
                typeText(dialogueTextEl, "ë°©ê¸ˆ ë§í–ˆë˜ ì•„ê¸° ì°¸ë‚˜ë¬´ë“¤ì€ ëª‡ ê·¸ë£¨ ì •ë„ ìë¼ê³  ìˆì„ê¹Œ?", () => {
                    showOakInput();
                });
                gameState.dialogueStep++;
            } else if (gameState.dialogueStep === initialDialogues.length + 2) {
                // ì°¸ë‚˜ë¬´ ì„¤ì • í›„
                const afterOakText = `ì°¸ë‚˜ë¬´ëŠ” ${gameState.oak}ê·¸ë£¨ ì •ë„ ìˆêµ¬ë‚˜!`;
                typeText(dialogueTextEl, afterOakText, () => {
                    gameState.dialogueStep++;
                });
            } else if (gameState.dialogueStep === initialDialogues.length + 3) {
                typeText(dialogueTextEl, "ì–´ë–¤ ì–´ë ¤ì›€ì´ ì°¾ì•„ì˜¬ì§€ ëª¨ë¥´ê² ì§€ë§Œ, ë‚´ ë‚˜ë¬´ìƒì˜ ëª©í‘œëŠ”!", () => {
                    gameState.dialogueStep++;
                });
            } else if (gameState.dialogueStep === initialDialogues.length + 4) {
                typeText(dialogueTextEl, "ìš°ë¦¬ ì†Œë‚˜ë¬´ ê°œì²´êµ°ì´ ì•ˆì •ì ìœ¼ë¡œ ì˜ ìœ ì§€ë˜ëŠ” ê±°ì•¼. ê·¸ëŸ´ ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤˜! ì˜ ë¶€íƒí•´!", () => {
                    gameState.dialogueComplete = true;
                    showGameActions();
                    enableButtons();
                });
            }
        }

        // í–‡ë¹› ì…ë ¥ì°½ í‘œì‹œ
        function showSunlightInput() {
            dialogueActionsEl.innerHTML = `
                <div class="input-container">
                    <span>í–‡ë¹› ì„¸ê¸°:</span>
                    <input type="number" id="sunlightInput" class="input-field" min="300" max="500" placeholder="300-500">
                    <button class="confirm-btn" onclick="setSunlightLevel()">í™•ì¸</button>
                </div>
            `;
            // nextBtnì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ í›„ ìˆ¨ê¸°ê¸°
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.style.display = 'none';
            }
        }

        // í–‡ë¹› ìˆ˜ì¤€ ì„¤ì •
        function setSunlightLevel() {
            const sunlightInput = document.getElementById('sunlightInput');
            const value = parseInt(sunlightInput.value);
            
            if (isNaN(value) || value < 300 || value > 500) {
                alert('300~500 ë²”ìœ„ ë‚´ì—ì„œ ì„¤ì •í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            gameState.sunlight = value;
            gameState.sunlightHistory = [value];
            updateDisplay();
            
            dialogueActionsEl.innerHTML = `<button class="next-btn" id="nextBtn">ğŸ“½</button>`;
            document.getElementById('nextBtn').addEventListener('click', nextDialogue);
            nextDialogue();
        }

        // ì°¸ë‚˜ë¬´ ì…ë ¥ì°½ í‘œì‹œ
        function showOakInput() {
            dialogueActionsEl.innerHTML = `
                <div class="input-container">
                    <span>ì°¸ë‚˜ë¬´ ê°œì²´ìˆ˜:</span>
                    <input type="number" id="oakInput" class="input-field" min="1" max="500" placeholder="1-500">
                    <button class="confirm-btn" onclick="setOakCount()">í™•ì¸</button>
                </div>
            `;
            // nextBtnì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ í›„ ìˆ¨ê¸°ê¸°
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.style.display = 'none';
            }
        }

        // ì°¸ë‚˜ë¬´ ê°œì²´ìˆ˜ ì„¤ì •
        function setOakCount() {
            const oakInput = document.getElementById('oakInput');
            const value = parseInt(oakInput.value);
            
            if (isNaN(value) || value < 1 || value > 500) {
                alert('1~500 ë²”ìœ„ ë‚´ì—ì„œ ì„¤ì •í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            gameState.oak = value;
            gameState.oakHistory = [value];
            updateDisplay();
            
            dialogueActionsEl.innerHTML = `<button class="next-btn" id="nextBtn">ğŸ“½</button>`;
            document.getElementById('nextBtn').addEventListener('click', nextDialogue);
            nextDialogue();
        }

        // ê²Œì„ ì•¡ì…˜ ë²„íŠ¼ í‘œì‹œ
        function showGameActions() {
            dialogueActionsEl.innerHTML = `
                <button class="action-btn" id="nextYearBtn">1ë…„ í›„~</button>
                <button class="next-btn" id="showHistoryBtn" title="íˆìŠ¤í† ë¦¬">ğŸ“‹</button>
            `;
            document.getElementById('nextYearBtn').addEventListener('click', nextYear);
            document.getElementById('showHistoryBtn').addEventListener('click', showHistory);
        }

        // 1ë…„ ì§„í–‰
        function nextYear() {
            if (!gameState.dialogueComplete || gameState.gameEnded) return;
            
            showLoading();
            setTimeout(() => {
                gameState.currentYear++;
                
                // 2ë…„ì°¨ ì„ íƒì§€ ë³´ë„ˆìŠ¤ ì ìš©
                if (gameState.currentYear === 4 && gameState.pendingBonus) {
                    gameState.population *= 1.2; // 20% ì¦ê°€
                    gameState.historyEvents.push(`${gameState.currentYear}ë…„ì°¨: ê·œì¹™ì„± ë¶„í¬ íš¨ê³¼ë¡œ ì†Œë‚˜ë¬´ ê°œì²´ìˆ˜ 20% ì¦ê°€`);
                    gameState.pendingBonus = null;
                }
                
                // ì´ë²¤íŠ¸ í™•ì¸
                if (gameState.currentYear === 2) {
                    hideLoading();
                    showCompetitionEvent();
                    return;
                } else if (gameState.currentYear === 4) {
                    hideLoading();
                    showOakGrowthEvent();
                    return;
                } else if (gameState.currentYear === 7) {
                    hideLoading();
                    showOakDominanceEvent();
                    return;
                }
                
                // ê¸°ë³¸ ìƒíƒœê³„ ì‹œë®¬ë ˆì´ì…˜
                simulateEcosystem();
                
                // ê²Œì„ ì¢…ë£Œ ì¡°ê±´ í™•ì¸
                if (gameState.population <= 5) {
                    showExtinctionEnding();
                } else if (gameState.currentYear >= 10) {
                    showSuccessEnding();
                } else {
                    showYearlyDialogue();
                }
                
                updateDisplay();
                hideLoading();
            }, 1500);
        }

        // ìƒíƒœê³„ ì‹œë®¬ë ˆì´ì…˜
        function simulateEcosystem() {
            const prevPopulation = gameState.population;
            
            // ê¸°ë³¸ ì„±ì¥ë¥ 
            const growthRate = 1.6;
            
            // í–‡ë¹›ì— ë”°ë¥¸ ì„±ì¥ ê³„ì‚°
            // í–‡ë¹›ì´ 1000-í–‡ë¹›ê°’ë³´ë‹¤ í¬ë©´ ì„±ì¥, ì‘ìœ¼ë©´ ê°ì†Œ
            
            if (gameState.sunlight > 300) {
                // ì†Œë‚˜ë¬´ ê°œì²´ìˆ˜ ì¦ê°€
                gameState.population = Math.min(1000, gameState.population * growthRate);
                // ì°¸ë‚˜ë¬´ ê°œì²´ìˆ˜ ê°ì†Œ (ì§€ìˆ˜ì )
                gameState.oak = Math.max(0, gameState.oak * 0.8);
            } else {
                // ì†Œë‚˜ë¬´ ê°œì²´ìˆ˜ ê°ì†Œ
                gameState.population = Math.max(0, gameState.population * 0.7);
                // ì°¸ë‚˜ë¬´ ê°œì²´ìˆ˜ ì¦ê°€ (ì§€ìˆ˜ì )
                gameState.oak = Math.min(1000, gameState.oak * 1.4);
                
                // í–‡ë¹› ë¶€ì¡±ìœ¼ë¡œ ì¸í•œ ìœ„ê¸° íˆìŠ¤í† ë¦¬ ì¶”ê°€
                gameState.historyEvents.push(`${gameState.currentYear}ë…„ì°¨: í–‡ë¹› ë¶€ì¡±ìœ¼ë¡œ ê°œì²´êµ° ìœ„ê¸°`);
            }
            
            // íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
            gameState.populationHistory.push(gameState.population);
            gameState.sunlightHistory.push(gameState.sunlight);
            gameState.oakHistory.push(gameState.oak);
        }

        // ì—°ì°¨ë³„ ëŒ€ì‚¬ í‘œì‹œ
        function showYearlyDialogue() {
            const currentPop = Math.floor(gameState.population);
            const prevPop = Math.floor(gameState.populationHistory[gameState.currentYear - 1] || currentPop);
            
            let dialogue = `ì§€ê¸ˆì€ ${gameState.currentYear}ë…„ì°¨ê³ , ìš°ë¦¬ ì†Œë‚˜ë¬´ ê°œì²´êµ°ì€ ${currentPop}ê·¸ë£¨ê°€ ë˜ì—ˆì–´.`;
            
            if (currentPop >= prevPop) {
                dialogue += " ë‹¤í–‰íˆ ì•„ì§ ìš°ë¦¬ ì†Œë‚˜ë¬´ ê°œì²´êµ°ì€ ì˜ ì‚´ì•„ìˆì–´. ì•ìœ¼ë¡œë„ ì˜ ë¶€íƒí•´.";
                characterEl.style.backgroundImage = "url('images/tree_happy.png')";
            } else {
                dialogue += " ë‚˜ëŠ” ì•„ì§ ì‚´ì•„ìˆì§€ë§Œ.. ì¹œêµ¬ì™€ ê°€ì¡±ë“¤ì„ ì¡°ê¸ˆ ìƒì—ˆì–´. ğŸ¥º";
                characterEl.style.backgroundImage = "url('images/tree_sad.png')";
            }
            
            // ëŒ€ì‚¬ íƒ€ì´í•‘ ì¤‘ì—ëŠ” ë²„íŠ¼ ë¹„í™œì„±í™”
            dialogueActionsEl.innerHTML = '';
            
            typeText(dialogueTextEl, dialogue, () => {
                // íƒ€ì´í•‘ì´ ì™„ì „íˆ ëë‚œ í›„ ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  ë²„íŠ¼ í™œì„±í™”
                setTimeout(() => {
                    showGameActions();
                }, 200);
            });
        }

        // 2ë…„ì°¨ ê²½ìŸ ì´ë²¤íŠ¸
        function showCompetitionEvent() {
            eventModalEl.style.display = 'flex';
            
            typeText(eventTextEl, "ê´‘í•©ì„±ì´ ì˜ ì´ë¤„ì§€ê¸° ìœ„í•´ì„œëŠ” ì§€ìƒë¶€ì˜ í–‡ë¹›ë¿ë§Œ ì•„ë‹ˆë¼ ì§€í•˜ë¶€ì˜ ë¬¼ë„ ê³µê¸‰ë°›ì•„ì•¼ í•œë‹¤. ë„ˆë¬´ ë§ì€ ì‹ë¬¼ë“¤ì´ ì¢ì€ ë•…ì— ëª°ë ¤ìˆìœ¼ë©´ ëª¨ë‘ì—ê²Œ ì†í•´ê°€ í¬ë‹¤. ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?", () => {
                eventActionsEl.innerHTML = `
                    <button class="choice-btn" onclick="chooseAllelopathy()">ë¿Œë¦¬ì—ì„œ íƒ€ê°ì‘ìš© ë¬¼ì§ˆì¸ ê°ˆë¡œíƒ„ë‹Œì„ ë¶„ë¹„í•œë‹¤.</button>
                    <button class="choice-btn" onclick="chooseDistribution()">ë¿Œë¦¬ë¥¼ ì ë‹¹íˆ ë»—ì–´ ë‹¤ë¥¸ ì†Œë‚˜ë¬´ì™€ì˜ ì ì •í•œ ê±°ë¦¬ë¥¼ í™•ë³´í•œë‹¤.</button>
                `;
            });
        }

        // íƒ€ê°ì‘ìš© ì„ íƒ
        function chooseAllelopathy() {
            playPositiveSound();
            gameState.population *= 1.15; // 15% ì¦ê°€
            gameState.historyEvents.push(`${gameState.currentYear}ë…„ì°¨: íƒ€ê°ì‘ìš©ìœ¼ë¡œ ì¢…ê°„ê²½ìŸì„ í•´ì†Œí•´ ì†Œë‚˜ë¬´ ê°œì²´ìˆ˜ 15% ì¦ê°€`);
            
            const successTexts = [
                "íƒ€ê°ì‘ìš©ì„ í†µí•´ ì£¼ë³€ì— ë‹¤ë¥¸ ì‹ë¬¼ë“¤ì´ ëª» ìë¼ê²Œ ë§‰ì•˜ë‹¤!",
                "[íš¨ê³¼] ì†Œë‚˜ë¬´ ê°œì²´ìˆ˜ 15% ì¦ê°€"
            ];
            
            showEventResults(successTexts, true, () => {
                // ê¸°ë³¸ ìƒíƒœê³„ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
                simulateEcosystem();
                
                if (gameState.population <= 5) {
                    showExtinctionEnding();
                } else {
                    showYearlyDialogue();
                }
                
                updateDisplay();
            });
        }

        // ê·œì¹™ì  ë¶„í¬ ì„ íƒ
        function chooseDistribution() {
            playPositiveSound();
            gameState.pendingBonus = true; // 2ë…„ í›„(4ë…„ì°¨) íš¨ê³¼ ì˜ˆì•½
            gameState.historyEvents.push(`${gameState.currentYear}ë…„ì°¨: ê·œì¹™ì„± ë¶„í¬ë¡œ ì¢…ë‚´ê²½ìŸì„ í•´ì†Œ, 2ë…„ í›„ ì†Œë‚˜ë¬´ ê°œì²´ìˆ˜ 20% ì¦ê°€ ì˜ˆì •`);
            
            const successTexts = [
                "ê·œì¹™ì ì¸ ë¶„í¬ë¥¼ í†µí•´ í† ì–‘ ì† ë¬¼ ìì›ì„ ë‚˜ëˆ ê°€ì¡Œë‹¤.",
                "ê°™ì€ ì†Œë‚˜ë¬´ë¼ë¦¬ ì˜¤ì†ë„ì† ì‚¬ì´ì¢‹ê²Œ ì§€ë‚´ì~",
                "[íš¨ê³¼] 2ë…„ í›„ ì†Œë‚˜ë¬´ ê°œì²´ìˆ˜ 20% ì¦ê°€"
            ];
            
            showEventResults(successTexts, true, () => {
                // ê¸°ë³¸ ìƒíƒœê³„ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
                simulateEcosystem();
                
                if (gameState.population <= 5) {
                    showExtinctionEnding();
                } else {
                    showYearlyDialogue();
                }
                
                updateDisplay();
            });
        }

        // 4ë…„ì°¨ ì°¸ë‚˜ë¬´ ì„±ì¥ ì´ë²¤íŠ¸
        function showOakGrowthEvent() {
            eventModalEl.style.display = 'flex';
            playNegativeSound();
            
            const eventTexts = [
                "ì‹ ì°¸ì´ì—ˆë˜ ì°¸ë‚˜ë¬´ë“¤ì´ ëˆˆ ê¹œì§í•  ìƒˆì— ë¬´ëŸ­ë¬´ëŸ­ ìë¼ë²„ë ¸ë‹¤!",
                "ì•„ë‹ˆâ€¦ë‚®ì€ ê³³ì€ ê·¸ëŠ˜ì´ ì ¸ì„œ ë¹›ì˜ ì„¸ê¸°ê°€ ì•½í–ˆì„ í…ë° ì–´ë–»ê²Œ ìëì§€?",
                "ì•„ë¬´íŠ¼ ì´ì œëŠ” ìš°ë¦¬ ì†Œë‚˜ë¬´ ê°œì²´êµ°ë³´ë‹¤ í‚¤ê°€ ì»¤ì ¸ë²„ë¦° ì°¸ë‚˜ë¬´ë“¤ì´ ììœ¼ë¡œ í–‡ë¹›ì„ ê°€ë¦¬ê¸° ì‹œì‘í–ˆë‹¤.",
                "ê´‘í•©ì„±ëŸ‰ì´ ì¤„ì–´ì„œ ì˜ˆì „ì²˜ëŸ¼ ë°°ë¶€ë¥´ê²Œ ì–‘ë¶„ì„ í•©ì„±í•˜ì§€ëŠ” ëª»í•  ë“¯í•˜ë‹¤.",
                "[íš¨ê³¼] í–‡ë¹› í¬ê¸° 30% ê°ì†Œ"
            ];
            
            // í–‡ë¹› 30% ê°ì†Œ
            gameState.sunlight *= 0.7;
            gameState.historyEvents.push(`${gameState.currentYear}ë…„ì°¨: ì°¸ë‚˜ë¬´ê°€ ìë¼ì„œ í˜¼í•©ë¦¼ì„ í˜•ì„±í•¨`);
            
            showEventResults(eventTexts, false, () => {
                // ê¸°ë³¸ ìƒíƒœê³„ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
                simulateEcosystem();
                
                if (gameState.population <= 5) {
                    showExtinctionEnding();
                } else {
                    showYearlyDialogue();
                }
                
                updateDisplay();
            });
        }

        // 7ë…„ì°¨ ì°¸ë‚˜ë¬´ ìš°ì„¸ ì´ë²¤íŠ¸
        function showOakDominanceEvent() {
            eventModalEl.style.display = 'flex';
            playNegativeSound();
            
            const eventTexts = [
                "ê¼¬ë¥´ë¥µâ€¦ì•„ ë„ˆë¬´ ë°°ê³ íŒŒ.",
                "í‚¤ê°€ í° ì°¸ë‚˜ë¬´ë“¤ì´ í›¨ì”¬ ë§ì•„ì ¸ì„œ ì†Œë‚˜ë¬´ë“¤ ìœ„ë¥¼ ë¬´ì„±í•˜ê²Œ ë®ì–´ë²„ë ¸ë‹¤.",
                "ì–´ë¥¸ ì†Œë‚˜ë¬´ë“¤ì€ ê·¸ë‚˜ë§ˆ ê´œì°®ì€ë°, ì•„ê¸° ì†Œë‚˜ë¬´ë“¤ì€ í–‡ë¹› ì–‘ì´ ë¶€ì¡±í•´ ìƒì¥í•˜ê¸° ì–´ë ¤ì›€ì„ ê²ªëŠ” ë“¯í•˜ë‹¤.",
                "ì•„â€¦í–‡ë¹› í˜¼ì ì“°ë‚˜â€¦.ã… ã… ",
                "[íš¨ê³¼] í–‡ë¹› í¬ê¸° 30% ê°ì†Œ"
            ];
            
            // í–‡ë¹› 30% ê°ì†Œ
            gameState.sunlight *= 0.7;
            gameState.historyEvents.push(`${gameState.currentYear}ë…„ì°¨: ì°¸ë‚˜ë¬´ê°€ ìë¼ì„œ ì–‘ìˆ˜ë¦¼ì„ í˜•ì„±í•´ê°`);
            
            showEventResults(eventTexts, false, () => {
                // ê¸°ë³¸ ìƒíƒœê³„ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
                simulateEcosystem();
                
                if (gameState.population <= 5) {
                    showExtinctionEnding();
                } else {
                    showYearlyDialogue();
                }
                
                updateDisplay();
            });
        }

        // ì´ë²¤íŠ¸ ê²°ê³¼ í‘œì‹œ
        function showEventResults(texts, isPositive, callback) {
            let currentTextIndex = 0;
            
            function showNextText() {
                if (currentTextIndex < texts.length) {
                    // ìƒ‰ìƒ í´ë˜ìŠ¤ ì ìš©
                    eventTextEl.className = isPositive ? 'event-text positive' : 'event-text negative';
                    typeText(eventTextEl, texts[currentTextIndex], () => {
                        currentTextIndex++;
                        if (currentTextIndex < texts.length) {
                            eventActionsEl.innerHTML = `<button class="event-next-btn" onclick="showNextText()">â–¼</button>`;
                        } else {
                            eventActionsEl.innerHTML = `<button class="event-next-btn" onclick="closeEvent()">ì™„ë£Œ</button>`;
                        }
                    });
                }
            }
            
            // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
            window.showNextText = showNextText;
            window.closeEvent = () => {
                eventModalEl.style.display = 'none';
                if (callback) callback();
            };
            
            showNextText();
        }

        // ì ˆë©¸ ì—”ë”©
        function showExtinctionEnding() {
            gameState.gameEnded = true;
            characterEl.style.backgroundImage = "url('images/tree_dead.png')";
            
            playFailureSound();
            showResultAnimation(false, () => {
                typeText(dialogueTextEl, `ìš°ë¦¬ ì†Œë‚˜ë¬´ ê°œì²´êµ°ì€ ${gameState.currentYear}ë…„ì°¨ì— ì—­ì‚¬ ì†ìœ¼ë¡œ ì‚¬ë¼ì§€ê²Œ ë˜ì—ˆì–´... ã… ã… `, () => {
                    dialogueActionsEl.innerHTML = `
                        <button class="action-btn secondary" onclick="restartGame()">ì¬ë„ì „</button>
                        <button class="action-btn danger" onclick="goToMain()">ë©”ì¸ í™”ë©´</button>
                        <button class="next-btn" id="showHistoryBtn" title="íˆìŠ¤í† ë¦¬">ğŸ“‹</button>
                    `;
                    document.getElementById('showHistoryBtn').addEventListener('click', showHistory);
                });
            });
        }

        // ì„±ê³µ ì—”ë”©
        function showSuccessEnding() {
            gameState.gameEnded = true;
            characterEl.style.backgroundImage = "url('images/tree_wow.png')";
            
            playSuccessSound();
            showResultAnimation(true, () => {
                typeText(dialogueTextEl, "ê³ ë§ˆì›Œ! ë„¤ ë•ë¶„ì— ìš°ë¦¬ ì†Œë‚˜ë¬´ ê°œì²´êµ°ì€ 10ë…„ ë™ì•ˆ ì•ˆì •ì ì¸ ê°œì²´êµ°ì„ ìœ ì§€í•  ìˆ˜ ìˆì—ˆì–´!", () => {
                    dialogueActionsEl.innerHTML = `
                        <button class="action-btn" onclick="goToMain()">ë©”ì¸ í™”ë©´</button>
                        <button class="next-btn" id="showHistoryBtn" title="íˆìŠ¤í† ë¦¬">ğŸ“‹</button>
                    `;
                    document.getElementById('showHistoryBtn').addEventListener('click', showHistory);
                }, 'dialogue-text success');
            });
        }

        // ê²Œì„ ê²°ê³¼ ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ
        function showResultAnimation(isSuccess, callback) {
            const animationEl = document.createElement('div');
            animationEl.className = `result-animation ${isSuccess ? 'success' : 'failure'}`;
            animationEl.textContent = isSuccess ? 'ğŸ‰ì„±ì¥ ì„±ê³µ!ğŸ‰' : 'ğŸ’” ì†Œë‚˜ë¬´ ì ˆë©¸...ğŸ’”';
            
            document.querySelector('.game-container').appendChild(animationEl);
            
            // 2ì´ˆ í›„ ì œê±°í•˜ê³  ì½œë°± ì‹¤í–‰
            setTimeout(() => {
                animationEl.remove();
                if (callback) callback();
            }, 2000);
        }

        // ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            yearDisplayEl.textContent = `${gameState.currentYear}ë…„ì°¨`;
            populationDisplayEl.textContent = `ê°œì²´ìˆ˜: ${Math.floor(gameState.population)}ê·¸ë£¨`;
            sunlightDisplayEl.textContent = `í–‡ë¹›: ${Math.floor(gameState.sunlight)}`;
            oakDisplayEl.textContent = `ì°¸ë‚˜ë¬´: ${Math.floor(gameState.oak)}ê·¸ë£¨`;
        }

        // ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
        function enableButtons() {
            graphBtnEl.disabled = false;
        }

        function disableButtons() {
            graphBtnEl.disabled = true;
        }

        // ë¡œë”© í‘œì‹œ
        function showLoading() {
            loadingOverlayEl.style.display = 'flex';
            typeText(document.getElementById('loadingText'), 'ë²ˆì‹ ì¤‘...');
        }

        function hideLoading() {
            loadingOverlayEl.style.display = 'none';
        }

        // ê·¸ë˜í”„ í‘œì‹œ
        function showGraph() {
            if (!gameState.dialogueComplete) return;

            graphModalEl.style.display = 'flex';
            
            setTimeout(() => {
                const canvas = document.getElementById('graphCanvas');
                const ctx = canvas.getContext('2d');
                
                // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
                const rect = canvas.getBoundingClientRect();
                const dpr = window.devicePixelRatio || 1;
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                ctx.scale(dpr, dpr);
                
                const width = rect.width;
                const height = rect.height;
                const padding = 80;
                const graphWidth = width - 2 * padding;
                const graphHeight = height - 2 * padding;
                
                // ë°°ê²½
                ctx.fillStyle = '#fafbfc';
                ctx.fillRect(0, 0, width, height);
                
                // ìµœëŒ€ê°’ ê³„ì‚°
                const maxPop = Math.max(...gameState.populationHistory);
                const maxOak = Math.max(...gameState.oakHistory);
                const maxYear = gameState.populationHistory.length - 1;
                
                // ê²©ìì„ 
                ctx.strokeStyle = '#e8ecf0';
                ctx.lineWidth = 1;
                
                for (let i = 0; i <= 8; i++) {
                    const y = padding + (i / 8) * graphHeight;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(width - padding, y);
                    ctx.stroke();
                }
                
                for (let i = 0; i <= maxYear; i++) {
                    const x = padding + (i / maxYear) * graphWidth;
                    ctx.beginPath();
                    ctx.moveTo(x, padding);
                    ctx.lineTo(x, height - padding);
                    ctx.stroke();
                }
                
                // ì¶•
                ctx.strokeStyle = '#2d3748';
                ctx.lineWidth = 2;
                ctx.beginPath();
                // ì™¼ìª½ Yì¶• (ì†Œë‚˜ë¬´)
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, height - padding);
                // ì˜¤ë¥¸ìª½ Yì¶• (ì°¸ë‚˜ë¬´)
                ctx.moveTo(width - padding, padding);
                ctx.lineTo(width - padding, height - padding);
                // Xì¶•
                ctx.moveTo(padding, height - padding);
                ctx.lineTo(width - padding, height - padding);
                ctx.stroke();
                
                // ì†Œë‚˜ë¬´ ê°œì²´ìˆ˜ ì„  (ì´ˆë¡ìƒ‰, ì™¼ìª½ ì¶• ê¸°ì¤€)
                if (gameState.populationHistory.length > 1) {
                    ctx.strokeStyle = '#16a34a';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    
                    for (let i = 0; i < gameState.populationHistory.length; i++) {
                        const x = padding + (i / maxYear) * graphWidth;
                        const y = height - padding - (gameState.populationHistory[i] / maxPop) * graphHeight;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.stroke();
                }
                
                // ì°¸ë‚˜ë¬´ ê°œì²´ìˆ˜ ì„  (ê°ˆìƒ‰, ì˜¤ë¥¸ìª½ ì¶• ê¸°ì¤€)
                if (gameState.oakHistory.length > 1) {
                    ctx.strokeStyle = '#a16207';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    
                    for (let i = 0; i < gameState.oakHistory.length; i++) {
                        const x = padding + (i / maxYear) * graphWidth;
                        const y = height - padding - (gameState.oakHistory[i] / maxOak) * graphHeight;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.stroke();
                }
                
                // ë ˆì´ë¸”
                ctx.fillStyle = '#4a5568';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                
                // Xì¶• ë ˆì´ë¸”
                for (let i = 0; i <= maxYear; i++) {
                    const x = padding + (i / maxYear) * graphWidth;
                    ctx.fillText(`${i}ë…„`, x, height - padding + 20);
                }
                
                // ì™¼ìª½ Yì¶• ë ˆì´ë¸” (ì†Œë‚˜ë¬´)
                ctx.textAlign = 'right';
                ctx.fillStyle = '#16a34a';
                for (let i = 0; i <= 8; i++) {
                    const y = height - padding - (i / 8) * graphHeight;
                    const value = Math.round((i / 8) * maxPop);
                    ctx.fillText(`${value}`, padding - 10, y + 4);
                }
                
                // ì˜¤ë¥¸ìª½ Yì¶• ë ˆì´ë¸” (ì°¸ë‚˜ë¬´)
                ctx.textAlign = 'left';
                ctx.fillStyle = '#a16207';
                for (let i = 0; i <= 8; i++) {
                    const y = height - padding - (i / 8) * graphHeight;
                    const value = Math.round((i / 8) * maxOak);
                    ctx.fillText(`${value}`, width - padding + 10, y + 4);
                }
                
                // ë²”ë¡€
                ctx.fillStyle = '#16a34a';
                ctx.fillRect(width / 2 - 80, 30, 20, 3);
                ctx.fillStyle = '#4a5568';
                ctx.textAlign = 'left';
                ctx.fillText('ì†Œë‚˜ë¬´ ê°œì²´ìˆ˜', width / 2 - 55, 35);
                
                ctx.fillStyle = '#a16207';
                ctx.fillRect(width / 2 - 80, 50, 20, 3);
                ctx.fillStyle = '#4a5568';
                ctx.fillText('ì°¸ë‚˜ë¬´ ê°œì²´ìˆ˜', width / 2 - 55, 55);
            }, 100);
        }

        // íˆìŠ¤í† ë¦¬ í‘œì‹œ
        function showHistory() {
            if (!gameState.dialogueComplete) return;

            historyModalEl.style.display = 'flex';
            
            let historyText = '';
            for (let i = 0; i < gameState.populationHistory.length; i++) {
                historyText += `${i}ë…„ì°¨: ì†Œë‚˜ë¬´ ${Math.floor(gameState.populationHistory[i])}ê·¸ë£¨`;
                if (gameState.oakHistory[i] !== undefined) {
                    historyText += `, ì°¸ë‚˜ë¬´ ${Math.floor(gameState.oakHistory[i])}ê·¸ë£¨`;
                }
                if (gameState.sunlightHistory[i] !== undefined) {
                    historyText += `, í–‡ë¹› ${Math.floor(gameState.sunlightHistory[i])}`;
                }
                historyText += '\n';
            }
            
            // ì´ë²¤íŠ¸ íˆìŠ¤í† ë¦¬ ì¶”ê°€
            if (gameState.historyEvents.length > 0) {
                historyText += '\n=== ì£¼ìš” ì‚¬ê±´ ===\n';
                gameState.historyEvents.forEach(event => {
                    historyText += event + '\n';
                });
            }
            
            historyContentEl.textContent = historyText;
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function hideGraph() {
            graphModalEl.style.display = 'none';
        }

        function hideHistory() {
            historyModalEl.style.display = 'none';
        }

        // ê²Œì„ ì¬ì‹œì‘/ì¢…ë£Œ
        function restartGame() {
            location.reload();
        }

        function goToMain() {
            window.location.href = 'index.html';
        }

        function goBack() {
            window.location.href = 'game.html';
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            updateDisplay();
            disableButtons();
            
            // ì²« ë²ˆì§¸ ëŒ€ì‚¬ ì‹œì‘í•˜ê³  dialogueStep ì¦ê°€
            typeText(dialogueTextEl, initialDialogues[0]);
            gameState.dialogueStep = 1; // ë‹¤ìŒ ë²„íŠ¼ í´ë¦­ ì‹œ ë‘ ë²ˆì§¸ ëŒ€ì‚¬ë¶€í„° ì‹œì‘
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            backBtnEl.addEventListener('click', goBack);
            graphBtnEl.addEventListener('click', showGraph);
            document.getElementById('closeGraphBtn').addEventListener('click', hideGraph);
            document.getElementById('closeHistoryBtn').addEventListener('click', hideHistory);
            document.getElementById('nextBtn').addEventListener('click', nextDialogue);
        });
    </script>
</body>
</html>